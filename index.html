<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Chat SL V.2.3.5</title>
<script src="/socket.io/socket.io.js"></script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Roboto&family=Press+Start+2P&family=Montserrat&family=Pacifico&family=Oswald&family=Raleway&display=swap" rel="stylesheet">
<style>
:root {
  --neon-blue: #00f0ff;
  --neon-purple: #b300ff;
  --neon-pink: #ff00d4;
}
body {
  margin: 0;
  padding: 0;
  font-family: 'Roboto', sans-serif;
  background: #111;
  overflow: hidden;
  transition: 0.3s;
  color: #fff;
}
button {
  cursor: pointer;
  font-family: 'Roboto', sans-serif;
}

/* BOTÃO FLUTUANTE */
#chatBtnFloat {
  position: fixed;
  bottom: 20px;
  right: 20px;
  z-index: 1000;
  width: 60px;
  height: 60px;
  border-radius: 50%;
  background: linear-gradient(45deg, var(--neon-blue), var(--neon-purple), var(--neon-pink));
  color: #fff;
  font-weight: bold;
  border: none;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.2rem;
  box-shadow: 0 0 10px #000;
  transition: 0.3s;
}
#chatBtnFloat:hover { transform: scale(1.1); }

/* POPUPS FLUTUANTES */
.popup {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: rgba(0,0,0,0.95);
  color: #fff;
  padding: 15px;
  border-radius: 12px;
  border: 2px solid var(--neon-blue);
  z-index: 999;
  display: none;
}
.popup h3 { margin-top:0; }
.popup input {
  display: block;
  width: 200px;
  margin: 5px 0;
  padding: 5px;
  border-radius: 5px;
  border: 1px solid #888;
  background: #333;
  color: #fff;
  font-family: 'Roboto', sans-serif;
}
.popup button { padding:5px 10px; margin-top:5px; }

/* POPUP TOPBAR */
.popup .topBar {
  display:flex;
  justify-content:space-between;
  align-items:center;
}
.popup .topBar span { cursor:pointer; font-weight:bold; font-size:1rem; }

/* CHAT FLUTUANTE PRINCIPAL */
#chatContainer {
  width: 540px;
  height: 430px;
  background: rgba(0,0,0,0.9);
  border:2px solid var(--neon-blue);
  border-radius:10px;
  display:flex;
  flex-direction:column;
  position:fixed;
  bottom:100px;
  right:20px;
  z-index:998;
  overflow:hidden;
  display:none;
}
#chatHeader {
  background: rgba(20,20,20,0.95);
  padding:5px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  border-bottom:1px solid #555;
  cursor:grab;
}
#chatMessages {
  flex:1;
  overflow-y:auto;
  padding:5px;
  display:flex;
  flex-direction:column;
  color:#fff;
}
#chatMessages > div { margin-bottom:5px; word-wrap:break-word; }
#chatInputContainer {
  display:flex;
  padding:5px;
  border-top:1px solid #555;
}
#chatInput {
  flex:1;
  padding:5px;
  border-radius:5px;
  border:1px solid #555;
  background:#333;
  color:#fff;
}

/* FRIENDS PANEL DESLIZANTE */
#friendsPanel {
  position: fixed;
  left: -220px;
  top: 0;
  width: 200px;
  height: 100%;
  background: rgba(20,20,20,0.95);
  border-right:2px solid var(--neon-blue);
  padding:10px;
  overflow-y:auto;
  transition:0.3s;
  z-index:999;
}
#friendsPanel.active { left:0; }
.friend { padding:5px; margin:3px 0; border-radius:5px; cursor:pointer; display:flex; justify-content:space-between; }
.friend.online { background: rgba(0,255,0,0.2); }
.friend.ausente { background: rgba(255,255,0,0.2); }
.friend.ocupado { background: rgba(255,0,0,0.2); }
.friend .blockBtn { color:red; cursor:pointer; }

/* SETTINGS PANEL */
#settingsPanel {
  position:fixed;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
  background: rgba(0,0,0,0.95);
  color:#fff;
  padding:15px;
  border-radius:12px;
  border:2px solid var(--neon-blue);
  z-index:999;
  display:none;
  width:250px;
}

/* Neon piscando */
.neonBlink { animation: neonBlinkAnim 1s infinite; }
@keyframes neonBlinkAnim {
  0%,100% { text-shadow:0 0 5px #fff; }
  50% { text-shadow:0 0 20px var(--neon-pink),0 0 30px var(--neon-purple); }
}
</style>
</head>
<body>

<!-- BOTÃO FLUTUANTE -->
<button id="chatBtnFloat" onclick="toggleChat()">💬</button>

<!-- POPUP LOGIN/CADASTRO -->
<div id="loginPopup" class="popup">
  <div class="topBar"><span>Entrar / Cadastrar</span><span onclick="closePopup('loginPopup')">X</span></div>
  <input type="text" id="usernameInput" placeholder="Nome de usuário">
  <input type="password" id="passwordInput" placeholder="Senha">
  <input type="password" id="passwordConfirmInput" placeholder="Confirme a senha">
  <button onclick="registerOrLogin()">Entrar / Cadastrar</button>
</div>

<!-- CHAT -->
<div id="chatContainer">
  <div id="chatHeader">
    Chat SL
    <div style="display:flex; gap:5px;">
      <div id="settingsGear" onclick="toggleSettings()">⚙</div>
      <span style="cursor:pointer;" onclick="minimizeChat()">_</span>
      <span style="cursor:pointer;" onclick="closePopup('chatContainer')">X</span>
    </div>
  </div>
  <div id="chatMessages"></div>
  <div id="chatInputContainer">
    <input id="chatInput" placeholder="Digite sua mensagem...">
    <button onclick="sendMessage()">Enviar</button>
    <button onclick="scrollToBottom(document.getElementById('chatMessages'))">🔽</button>
    <button onclick="toggleEmojiPanel()">😊</button>
  </div>
</div>

<!-- FRIENDS PANEL -->
<div id="friendsPanel">
  <div class="topBar">
    <span>Amigos Online</span>
    <div onclick="toggleFriendsPanel()" style="cursor:pointer;">_</div>
  </div>
  <ul id="friendsList"></ul>
</div>

<!-- EMOJI PANEL -->
<div id="emojiPanel" class="popup" style="width:250px; max-height:200px; overflow-y:auto; display:none;">
  <div style="display:flex; flex-wrap:wrap; gap:5px;">
    <span onclick="addEmoji('😀')">😀</span>
    <span onclick="addEmoji('😂')">😂</span>
    <span onclick="addEmoji('😎')">😎</span>
    <span onclick="addEmoji('😍')">😍</span>
    <span onclick="addEmoji('🤯')">🤯</span>
    <span onclick="addEmoji('🥳')">🥳</span>
    <span onclick="addEmoji('😢')">😢</span>
    <span onclick="addEmoji('😡')">😡</span>
    <span onclick="addEmoji('👍')">👍</span>
    <span onclick="addEmoji('👎')">👎</span>
  </div>
</div>

<!-- SETTINGS -->
<div id="settingsPanel" class="popup">
  <div class="topBar"><span>Configurações</span><span onclick="closePopup('settingsPanel')">X</span></div>
  <p>Fundo: 
    <button onclick="setBgImage('https://xatframe.github.io/xatframes/RobFerrari_Balloons.html')">Balões</button>
    <button onclick="setBgImage('https://xatframe.github.io/xatframes/lafleur_sea.html')">Sea</button>
    <button onclick="setBgImage('https://xatframe.github.io/xatframes/robferrari_xneon.html')">XNeon</button>
    <button onclick="setBgColor('#111')">Cor Sólida</button>
  </p>
  <p>Fonte: <select id="fontSelect"></select></p>
  <p>Status: 
    <button onclick="setStatus('online')">🟢</button>
    <button onclick="setStatus('ausente')">🟡</button>
    <button onclick="setStatus('ocupado')">🔴</button>
  </p>
  <p>Neon: <input type="checkbox" id="neonToggle"><label for="neonToggle">Ativar</label></p>
  <p>Cor Neon: <input type="color" id="neonColor" value="#ff00d4"></p>
</div>

<script>
const socket = io('https://meu-chat-lin7.onrender.com');
let currentUser = null;
let neonActive = false;
let userSettings = {};

// FUNÇÕES DE UI
function toggleChat(){
  const chat = document.getElementById('chatContainer');
  const login = document.getElementById('loginPopup');
  if(chat.style.display==='flex'){ chat.style.display='none'; }
  else{ currentUser?chat.style.display='flex':login.style.display='block'; }
}
function minimizeChat(){ document.getElementById('chatContainer').style.display='none'; }
function closePopup(id){ document.getElementById(id).style.display='none'; }
function toggleFriendsPanel(){ document.getElementById('friendsPanel').classList.toggle('active'); }
function toggleEmojiPanel(){
  const panel = document.getElementById('emojiPanel');
  panel.style.display = (panel.style.display==='block')?'none':'block';
}
function toggleSettings(){
  const panel = document.getElementById('settingsPanel');
  panel.style.display = (panel.style.display==='block')?'none':'block';
}

// LOGIN/CADASTRO SIMPLIFICADO
function registerOrLogin(){
  const name = document.getElementById('usernameInput').value;
  const pass = document.getElementById('passwordInput').value;
  const passConfirm = document.getElementById('passwordConfirmInput').value;
  if(!name||!pass){ alert('Digite nome e senha'); return; }
  if(pass!==passConfirm){ alert('Senhas não conferem'); return; }
  currentUser = name;
  document.getElementById('loginPopup').style.display='none';
  document.getElementById('chatContainer').style.display='flex';
  socket.emit('user connected', { name:currentUser, status:'online', color:'#fff' });
}

// LOGOUT
function logout(){
  currentUser=null;
  document.getElementById('chatContainer').style.display='none';
  document.getElementById('loginPopup').style.display='block';
}

// MENSAGENS
function sendMessage(){
  const input=document.getElementById('chatInput');
  if(input.value.trim()==='') return;
  const message=input.value;
  socket.emit('chat message',{ username:currentUser,message:message,settings:userSettings });
  input.value='';
}
function scrollToBottom(el){ if(el) el.scrollTop=el.scrollHeight; }
function addEmoji(emoji){ const input=document.getElementById('chatInput'); input.value+=emoji; input.focus(); }

// CONFIGURAÇÕES
document.getElementById('neonToggle').addEventListener('change',e=> neonActive=e.target.checked );
document.getElementById('neonColor').addEventListener('change',e=> userSettings.neonColor=e.target.value );
document.getElementById('fontSelect').addEventListener('change',e=>{
  userSettings.font=e.target.value;
  document.getElementById('chatMessages').style.fontFamily=userSettings.font;
  document.getElementById('chatInput').style.fontFamily=userSettings.font;
});

function setBgImage(url){
  const chat=document.getElementById('chatContainer');
  chat.style.backgroundImage=`url('${url}')`;
  chat.style.backgroundColor='transparent';
  userSettings.bg=url;
}
function setBgColor(color){
  const chat=document.getElementById('chatContainer');
  chat.style.backgroundColor=color;
  chat.style.backgroundImage='none';
  userSettings.bg=color;
}
function setStatus(status){
  userSettings.status=status;
  socket.emit('user status update',{ name:currentUser,status:status });
}

// INIT
document.addEventListener('DOMContentLoaded',()=>{
  document.getElementById('loginPopup').style.display='block';
  
  // Fontes (mais de 50)
  const fontSelect=document.getElementById('fontSelect');
  const fonts=['Roboto','Press Start 2P','Montserrat','Pacifico','Oswald','Raleway','Lobster','Poppins','Indie Flower','Caveat','Anton','Bebas Neue','Dancing Script','Fira Sans','Fira Code','Josefin Sans','Nunito','Quicksand','Rubik','Saira','Ubuntu','Varela Round','Yeseva One','Zilla Slab','Kanit','Mukta','Muli','Righteous','Satisfy','Sawarabi Gothic','Shadows Into Light','Signika','Space Mono','Spectral','Teko','Titillium Web','Varela','Work Sans','Acme','Alef','Amatic SC','Arimo','Arvo','Bangers','BenchNine','BioRhyme','Cabin','Chivo','Cormorant Garamond','Crimson Text','DM Sans'];
  fonts.forEach(f=>{ const opt=document.createElement('option'); opt.value=f; opt.textContent=f; fontSelect.appendChild(opt); });

  // Drag
  const dragElement=(el,header)=>{
    let dragging=false,offsetX,offsetY;
    header.addEventListener('mousedown',e=>{
      dragging=true;
      offsetX=e.clientX-el.getBoundingClientRect().left;
      offsetY=e.clientY-el.getBoundingClientRect().top;
      el.style.cursor='grabbing';
    });
    document.addEventListener('mousemove',e=>{
      if(!dragging) return;
      el.style.left=`${e.clientX-offsetX}px`;
      el.style.top=`${e.clientY-offsetY}px`;
    });
    document.addEventListener('mouseup',()=>{ dragging=false; el.style.cursor='grab'; });
  };
  dragElement(document.getElementById('chatContainer'),document.getElementById('chatHeader'));
  dragElement(document.getElementById('loginPopup'),document.getElementById('loginPopup').querySelector('.topBar'));
  dragElement(document.getElementById('emojiPanel'),document.getElementById('emojiPanel').querySelector('.topBar'));
  dragElement(document.getElementById('settingsPanel'),document.getElementById('settingsPanel').querySelector('.topBar'));
});

// SOCKET
socket.on('chat message',msg=>{
  const chatMessages=document.getElementById('chatMessages');
  const msgDiv=document.createElement('div');
  const userFont=msg.settings && msg.settings.font ? msg.settings.font:'Roboto';
  const content=msg.settings && msg.settings.neonActive? `<span class="neonBlink" style="color:${msg.settings.neonColor}">${msg.message}</span>`:msg.message;
  msgDiv.innerHTML=`<b style="font-family:'${userFont}'">${msg.username}:</b> <span style="font-family:'${userFont}'">${content}</span>`;
  chatMessages.appendChild(msgDiv);
  scrollToBottom(chatMessages);
});

socket.on('user list update',updatedUsers=>{
  const friendsList=document.getElementById('friendsList');
  friendsList.innerHTML='';
  Object.values(updatedUsers).forEach(u=>{
    if(u.name!==currentUser){
      const f=document.createElement('li');
      f.className='friend '+u.status;
      f.innerHTML=`<span onclick="alert('Chat privado ainda não implementado')">${u.name} (${u.status})</span>`;
      friendsList.appendChild(f);
    }
  });
});
</script>
</body>
</html>
