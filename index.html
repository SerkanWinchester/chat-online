<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat Online</title>
    <script src="https://unpkg.com/feather-icons"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Roboto&family=Open+Sans&family=Lato&family=Montserrat&family=Oswald&family=Raleway&family=Poppins&family=Nunito&family=Playfair+Display&family=Merriweather&family=Indie+Flower&family=Dancing+Script&family=Pacifico&family=Lobster&family=Source+Code+Pro&family=Nunito+Sans&family=Inter&family=Work+Sans&family=Fira+Sans&family=Source+Sans+Pro&family=PT+Sans&family=Ubuntu&family=Lora&family=Quicksand&family=Comfortaa&family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200&family=Bebas+Neue&family=Kanit&family=Permanent+Marker&family=Anton&family=Archivo+Black&family=Abril+Fatface&family=Josefin+Sans&family=Satisfy&family=Courgette&family=Noto+Sans&family=Dosis&family=Merriweather+Sans&family=Concert+One&family=Passion+One&family=Barlow&family=Caveat&family=Alfa+Slab+One&family=Exo+2&family=Secular+One&display=swap" rel="stylesheet" />
    <style>
        body { margin: 0; font-family: Arial, sans-serif; background: #f0f2f5; overflow: hidden; }
        #chatIcon { position: fixed; bottom: 20px; right: 20px; width: 60px; height: 60px; border-radius: 50%; background: black; display: flex; justify-content: center; align-items: center; cursor: pointer; box-shadow: 0 0 20px rgba(255,0,255,0.5), 0 0 20px rgba(0,255,255,0.5); z-index: 1000; }
        .chat-window { 
            position: fixed; 
            bottom: 90px; 
            right: 20px; 
            width: 590px; 
            height: 470px; 
            background: rgba(255, 255, 255, 0.2); 
            backdrop-filter: blur(10px); 
            -webkit-backdrop-filter: blur(10px);
            border-radius: 15px; 
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1); 
            border: 1px solid rgba(255, 255, 255, 0.3);
            display: none; 
            flex-direction: column; 
            overflow: hidden; 
            z-index: 999; 
            opacity: 0; 
            transform: translateY(20px); 
            pointer-events: none; 
            transition: opacity 0.3s ease, transform 0.3s ease; 
        }
        .chat-window.open { display: flex; opacity: 1; transform: translateY(0); pointer-events: auto; }
        .chat-window.maximized { width: 100vw; height: 100vh; bottom: 0; right: 0; border-radius: 0; }
        .chat-window.minimized { height: 40px; }
        .chat-window.mobile-view { width: 100vw; height: 100vh; bottom: 0; right: 0; border-radius: 0; }
        .chat-header { 
            background: rgba(255, 255, 255, 0.3); 
            padding: 10px 15px; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            border-bottom: 1px solid rgba(255, 255, 255, 0.5); 
            position: relative; 
            min-height: 40px; 
        }
        .header-icons-left, .header-icons-right { display: flex; align-items: center; gap: 15px; }
        .chat-header h2 { margin: 0; font-size: 18px; color: #111; position: absolute; left: 50%; transform: translateX(-50%); white-space: nowrap; }
        .screen { display: none; flex: 1; padding: 20px; overflow-y: auto; flex-direction: column; justify-content: center; align-items: center; gap: 15px; }
        #chatScreen { justify-content: flex-start; align-items: stretch; }
        #chatScreen[style*="background-color"] { background-color: var(--chat-wallpaper-color, #fff); }
        .chat-message { 
            background-color: rgba(255, 255, 255, 0.4) !important; 
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            border: 1px solid rgba(255, 255, 255, 0.5);
            padding: 8px 12px; 
            border-radius: 18px; 
            margin-bottom: 8px; 
            max-width: 80%; 
            align-self: flex-start; 
            word-wrap: break-word; 
            position: relative; 
            cursor: pointer; 
        }
        .chat-message.my-message { align-self: flex-end; }
        .system-message { text-align: center; font-size: 12px; color: #888; margin: 8px 0; font-style: italic; }
        .admin-star { margin-right: 5px; color: #ffc107; }
        .room-lock-icon { margin-left: auto; color: #dc3545; }
        .invite-message { background-color: #e9f5ff; border-left: 4px solid #007bff; padding: 10px; margin: 10px 5%; border-radius: 4px; font-size: 14px; }
        .invite-message p { margin: 0 0 10px 0; }
        .invite-message button { background-color: #007bff; color: white; border: none; padding: 5px 10px; margin-right: 10px; border-radius: 4px; cursor: pointer; font-size: 12px; width: auto; }
        .invite-message button.decline { background-color: #ccc; color: #333; }
        .chat-footer { position: relative; background: #ffffff; padding: 8px 10px; display: flex; align-items: center; gap: 8px; border-top: 1px solid #e0e0e0; }
        .footer-toolbar { display: flex; align-items: center; gap: 4px; }
        .tool-button { background: transparent; border: none; padding: 4px; cursor: pointer; border-radius: 4px; color: black; display: flex; }
        .tool-button.active { background-color: #e0e0e0; }
        .tool-button i { width: 16px; height: 16px; }
        #font-select { border-radius: 4px; border: 1px solid #ccc; background: white; max-width: 100%; font-size: 12px; }
        input[type="text"]#usernameInput {
            background: rgba(0, 0, 0, 0.1);
            color: #000;
            border: none;
            outline: none;
            flex: 1;
            padding: 8px;
            border-radius: 8px;
        }
        #messageInput { flex: 1; border: 1px solid #ccc; padding: 8px; border-radius: 15px; color: #111; max-height: 80px; overflow-y: auto; background: white; }
        #sendBtn { background: transparent; border: none; padding: 4px; cursor: pointer; width: auto; color: black; display: flex; }
        #sendBtn i { width: 20px; height: 20px; }
        .emoji-button { font-size: 20px; border: none; background: none; cursor: pointer; }
        .emoji-picker-container { display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; max-height: 150px; overflow-y: auto; padding: 5px; }
        .emoji-category-tabs { display: flex; justify-content: center; margin-bottom: 10px; }
        .emoji-category-tabs button { padding: 5px 10px; border: none; background: #eee; cursor: pointer; }
        #formatting-popup {
            position: absolute;
            bottom: calc(100% + 5px);
            left: 10px;
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            padding: 8px;
            display: none;
            flex-wrap: nowrap;
            gap: 4px;
            width: 95%;
            overflow-x: auto;
            border: 1px solid #ddd;
            z-index: 1003;
        }
        #formatting-popup.open { display: flex; }
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); display: none; justify-content: center; align-items: center; z-index: 1002; }
        .modal-content { background: white; padding: 20px; border-radius: 10px; max-width: 400px; width: 90%; box-shadow: 0 5px 15px rgba(0,0,0,0.3); display: flex; flex-direction: column; align-items: center; position: relative;}
        .modal-header { display: flex; justify-content: center; align-items: center; border-bottom: 1px solid #e0e0e0; padding-bottom: 10px; margin-bottom: 15px; width: 100%; }
        .modal-header h2 { margin: 0; font-size: 18px; }
        .modal-close-btn { position: absolute; top: 10px; right: 10px; background: none; border: none; font-size: 24px; cursor: pointer; color: #999; }
        .screen.active { display: flex; }
        .form-group { display: flex; align-items: center; border-bottom: 1px solid #e0e0e0; padding: 5px; width: 90%; }
        input { border: none; outline: none; flex: 1; padding: 8px; background: transparent; }
        button { background: black; color: white; border: none; border-radius: 5px; padding: 10px; font-weight: bold; cursor: pointer; width: 90%; margin-top: 10px; }
        .header-button { background: none; border: none; padding: 0; cursor: pointer; color: #333; }
        .emoji-button {
            font-size: 24px;
            border: none;
            background: none;
            cursor: pointer;
            padding: 5px;
            flex-basis: calc(100% / 7);
            max-width: calc(100% / 7);
            box-sizing: border-box;
        }
        /* ADMIN PANEL STYLES */
        #admin-panel-modal .modal-content {
            overflow-y: auto;
            max-height: 80vh;
            display: flex;
            flex-direction: column;
            gap: 15px;
            padding: 20px;
        }
        .admin-global-message-container {
            width: 100%;
            padding-top: 20px;
            border-top: 1px solid #e0e0e0;
        }
        .admin-global-formatting-toolbar {
            display: flex;
            flex-wrap: nowrap;
            overflow-x: auto;
            gap: 4px;
            width: 100%;
            margin-bottom: 10px;
            padding: 5px 0;
            border-radius: 5px;
            background-color: #f1f1f1;
            align-items: center;
        }
        .admin-global-formatting-toolbar select {
            border-radius: 4px;
            border: 1px solid #ccc;
            background: white;
            max-width: 100%;
            font-size: 12px;
        }
        #adminGlobalMessage {
            flex: 1;
            border: 1px solid #ccc;
            border-radius: 15px;
            padding: 8px;
            min-height: 50px;
            max-height: 100px;
            overflow-y: auto;
        }
        .global-message {
            position: relative;
            text-align: center;
            padding: 10px;
            margin: 10px 0;
            border-radius: 10px;
            font-weight: bold;
            color: white;
            background: linear-gradient(45deg, #007bff, #dc3545, #28a745);
            border: 2px solid;
            border-image: linear-gradient(45deg, #007bff, #dc3545, #28a745) 1;
        }
        /* OUTROS ESTILOS JÃ EXISTENTES */
        #admin-stats { margin-bottom: 20px; text-align: center; font-size: 14px; }
        #admin-room-list { margin-top: 15px; width: 90%; text-align: left; font-size: 14px; }
        #admin-room-list ul { list-style: none; padding: 0; margin: 0; }
        #admin-room-list li { margin-bottom: 5px; }
        .admin-search-group { display: flex; flex-direction: column; width: 90%; gap: 10px; margin-bottom: 20px; }
        .admin-search-group input { border: 1px solid #ccc; border-radius: 5px; }
        .admin-search-group button { margin-top: 0; }
        #admin-search-results { margin-top: 15px; width: 90%; text-align: center; font-size: 14px; min-height: 20px; }
        .reactions-display { 
            display: flex; 
            gap: 5px;
            flex-wrap: wrap; 
        }
        .reaction-count { display: flex; align-items: center; background-color: #f1f1f1; border-radius: 12px; padding: 2px 6px; font-size: 12px; }
        .reaction-count i { width: 12px; height: 12px; margin-right: 3px; }
        .highlighted { background-color: yellow; }
        #messageInput.font-size-small { font-size: 12px; }
        #messageInput.font-size-medium { font-size: 16px; }
        #messageInput.font-size-large { font-size: 20px; }
        .shake-animation {
            animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both;
            transform: translate3d(0, 0, 0);
            backface-visibility: hidden;
            perspective: 1000px;
        }
        @keyframes shake {
            10%, 90% { transform: translate3d(-1px, 0, 0); }
            20%, 80% { transform: translate3d(2px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
            40%, 60% { transform: translate3d(4px, 0, 0); }
        }
    </style>
</head>
<body>
    <div id="chatIcon"><i data-feather="message-square"></i></div>
    <audio id="messageSound" src="https://www.soundjay.com/buttons/button-10.mp3" preload="auto"></audio>
    <audio id="applauseSound" src="https://assets.mixkit.co/sfx/preview/mixkit-small-group-of-people-applauding-511.mp3" preload="auto"></audio>
    <audio id="screamSound" src="https://assets.mixkit.co/sfx/preview/mixkit-scream-of-a-man-in-fear-1279.mp3" preload="auto"></audio>
    <audio id="attentionSound" src="https://assets.mixkit.co/sfx/preview/mixkit-attention-bell-2759.mp3" preload="auto"></audio>
    <audio id="thumbsUpSound" src="https://www.soundjay.com/buttons/sounds/button-36.mp3" preload="auto"></audio>
    <audio id="heartSound" src="https://www.soundjay.com/buttons/sounds/button-18.mp3" preload="auto"></audio>
    <audio id="smileSound" src="https://www.soundjay.com/buttons/sounds/button-3.mp3" preload="auto"></audio>
    <audio id="starSound" src="https://www.soundjay.com/buttons/sounds/button-2.mp3" preload="auto"></audio>
    <audio id="frownSound" src="https://www.soundjay.com/buttons/sounds/button-37.mp3" preload="auto"></audio>
    <audio id="thumbsDownSound" src="https://www.soundjay.com/buttons/sounds/button-1.mp3" preload="auto"></audio>
    <audio id="helpCircleSound" src="https://www.soundjay.com/buttons/sounds/button-7.mp3" preload="auto"></audio>
    <audio id="checkCircleSound" src="https://www.soundjay.com/buttons/sounds/button-23.mp3" preload="auto"></audio>


    <div class="chat-window" id="chatWindow">
        <div class="chat-header">
            <div class="header-icons-left">
                <button id="backToChatBtn" class="header-button"><i data-feather="arrow-left"></i></button>
                <button id="roomsBtn" class="header-button"><i data-feather="hash"></i></button>
                <button id="usersOnlineBtn" class="header-button" title="Online Users" style="display: none;"><i data-feather="users"></i></button>
                <button id="audioToggleBtn" class="header-button" title="Toggle Notifications" style="display: none;"><i data-feather="volume-2"></i></button>
                <button id="minimizeChatBtn" class="header-button" title="Minimize" style="display: none;"><i data-feather="minus"></i></button>
                <button id="maximizeChatBtn" class="header-button" title="Maximize" style="display: none;"><i data-feather="maximize-2"></i></button>
                <button id="restoreChatBtn" class="header-button" title="Restore" style="display: none;"><i data-feather="minimize-2"></i></button>
                <button id="mobileViewBtn" class="header-button" title="Mobile View" style="display: none;"><i data-feather="smartphone"></i></button>
            </div>
            <h2 id="screenTitle">Login</h2>
            <div class="header-icons-right">
                <button id="inviteUserBtn" class="header-button" title="Invite user" style="display: none;"><i data-feather="search"></i></button>
                <button id="adminPanelBtn" class="header-button" title="Admin Panel" style="display: none;"><i data-feather="star"></i></button>
                <button id="roomLockBtn" class="header-button" title="Lock/Unlock Room" style="display: none;"><i data-feather="unlock"></i></button>
                <button id="alarmBtn" class="header-button" title="Call attention" style="display: none;"><i data-feather="bell"></i></button>
                <button id="colorPaletteBtn" class="header-button" title="Change wallpaper color" style="display: none;"><i data-feather="droplet"></i></button>
                <input type="color" id="chatWallpaperColor" style="display: none;" />
                <button id="saveChatBtn" class="header-button" title="Save chat as PDF" style="display: none;"><i data-feather="save"></i></button>
                <button id="logoutBtn" class="header-button"><i data-feather="power"></i></button>
            </div>
        </div>
        <div class="screen active" id="loginScreen"><div class="form-group"><i data-feather="user"></i><input type="text" id="usernameInput" placeholder="Create username" /></div><button id="loginBtn">Enter</button></div>
        <div class="screen" id="chatScreen"></div>
        <div class="chat-footer" id="chatFooter">
            <div id="formatting-popup">
                <button class="tool-button" data-command="bold" title="Bold"><i data-feather="bold"></i></button>
                <button class="tool-button" data-command="italic" title="Italic"><i data-feather="italic"></i></button>
                <button class="tool-button" data-command="underline" title="Underline"><i data-feather="underline"></i></button>
                <button class="tool-button" data-command="strikethrough" title="Strikethrough"><i data-feather="minus"></i></button>
                <button class="tool-button" data-command="shadow" title="Shadow"><i data-feather="type"></i></button>
                <select id="font-select" title="Text Font"></select>
                <button class="tool-button" id="fontSizePlusBtn" title="Increase Font"><i data-feather="plus-circle"></i></button>
                <button class="tool-button" id="fontSizeMinusBtn" title="Decrease Font"><i data-feather="minus-circle"></i></button>
                <button class="tool-button" id="highlightBtn" title="Highlight Text"><i data-feather="pen-tool"></i></button>
                <input type="color" id="highlightPicker" style="display: none;" />
                <button class="tool-button" id="colorBtn" title="Text Color"><i data-feather="edit-3"></i></button>
                <input type="color" id="colorPicker" style="display: none;" />
            </div>
            <div class="footer-toolbar">
                <button class="tool-button" id="toggleFormattingBtn" title="Format Text"><i data-feather="plus"></i></button>
                <button class="tool-button" id="mentionBtn" title="Mention/Reply"><i data-feather="at-sign"></i></button>
                <button id="attachFileBtn" class="tool-button" title="Attach file"><i data-feather="paperclip"></i></button>
                <input type="file" id="fileUpload" accept="image/*" style="display: none;" />
                <button id="emojiBtn" class="tool-button" title="Emojis"><span class="material-symbols-outlined">sentiment_satisfied</span></button>
            </div>
            <div id="messageInput" contenteditable="true" spellcheck="false"></div>
            <button id="sendBtn" title="Send message"><i data-feather="send"></i></button>
        </div>
    </div>
    
    <div class="modal-overlay" id="reaction-popup">
        <div class="modal-content">
            <button class="modal-close-btn" data-target="reaction-popup">&times;</button>
            <div class="reaction-options">
                <button class="reaction-button" data-message-id="" data-reaction="thumbs-up"><i data-feather="thumbs-up"></i></button>
                <button class="reaction-button" data-message-id="" data-reaction="heart"><i data-feather="heart"></i></button>
                <button class="reaction-button" data-message-id="" data-reaction="smile"><i data-feather="smile"></i></button>
                <button class="reaction-button" data-message-id="" data-reaction="star"><i data-feather="star"></i></button>
                <button class="reaction-button" data-message-id="" data-reaction="frown"><i data-feather="frown"></i></button>
                <button class="reaction-button" data-message-id="" data-reaction="thumbs-down"><i data-feather="thumbs-down"></i></button>
                <button class="reaction-button" data-message-id="" data-reaction="help-circle"><i data-feather="help-circle"></i></button>
                <button class="reaction-button" data-message-id="" data-reaction="check-circle"><i data-feather="check-circle"></i></button>
            </div>
            <div class="post-actions-buttons">
                <button class="action-button edit-post" title="Edit"><i data-feather="edit-2"></i></button>
                <button class="action-button delete-post" data-message-id="${messageId}" title="Delete"><i data-feather="trash-2"></i></button>
            </div>
        </div>
    </div>
    
    <div class="modal-overlay" id="emoji-modal">
        <div class="modal-content">
            <button class="modal-close-btn" data-target="emoji-modal">&times;</button>
            <div class="modal-header"><h2>Choose Emoji</h2></div>
            <div id="emoji-picker"></div>
        </div>
    </div>

    <div class="modal-overlay" id="rooms-modal">
        <div class="modal-content">
            <button class="modal-close-btn" data-target="rooms-modal">&times;</button>
            <div class="modal-header"><h2>Change Room</h2></div>
            <div class="form-group"><i data-feather="hash"></i><input type="number" id="roomNumberInput" placeholder="Room number (0 = General)" min="0" /></div>
            <button id="joinRoomBtn">Join Room</button>
        </div>
    </div>

    <div class="modal-overlay" id="users-online-modal">
        <div class="modal-content">
            <button class="modal-close-btn" data-target="users-online-modal">&times;</button>
            <div class="modal-header"><h2>Online Users</h2></div>
            <div id="users-list"></div>
        </div>
    </div>

    <div class="modal-overlay" id="alarm-modal">
        <div class="modal-content">
            <button class="modal-close-btn" data-target="alarm-modal">&times;</button>
            <div class="modal-header"><h2>Call Attention</h2></div>
            <div id="alarm-options"></div>
        </div>
    </div>

    <div class="modal-overlay" id="invite-modal">
        <div class="modal-content">
            <button class="modal-close-btn" data-target="invite-modal">&times;</button>
            <div class="modal-header"><h2>Invite User</h2></div>
            <div class="form-group">
                <i data-feather="user"></i>
                <input type="text" id="usernameToInviteInput" placeholder="Username" />
            </div>
            <button id="sendInviteBtn">Invite</button>
        </div>
    </div>
    
    <div class="modal-overlay" id="admin-panel-modal">
        <div class="modal-content">
            <button class="modal-close-btn" data-target="admin-panel-modal">&times;</button>
            <div class="modal-header"><h2>Admin Panel</h2></div>
            <div id="admin-stats"></div>
            <div class="admin-search-group">
                <input type="text" id="adminUserInput" placeholder="Search by user" />
                <button id="adminUserSearchBtn">Search User</button>
            </div>
            <div class="admin-search-group">
                <input type="number" id="adminRoomInput" placeholder="Search by room #" min="0" />
                <button id="adminRoomSearchBtn">Search Room</button>
            </div>
            <div id="admin-room-list"></div>
            <div class="admin-icon-toggles">
                <label><input type="checkbox" id="toggleRoomsBtn" checked /> Rooms</label>
                <label><input type="checkbox" id="toggleUsersOnlineBtn" checked /> Users Online</label>
                <label><input type="checkbox" id="toggleAudioToggleBtn" checked /> Audio</label>
                <label><input type="checkbox" id="toggleMinimizeChatBtn" checked /> Minimize</label>
                <label><input type="checkbox" id="toggleMaximizeChatBtn" checked /> Maximize</label>
                <label><input type="checkbox" id="toggleInviteUserBtn" checked /> Invite User</label>
                <label><input type="checkbox" id="toggleAdminPanelBtn" checked /> Admin Panel</label>
                <label><input type="checkbox" id="toggleRoomLockBtn" checked /> Room Lock</label>
                <label><input type="checkbox" id="toggleAlarmBtn" checked /> Alarm</label>
                <label><input type="checkbox" id="toggleColorPaletteBtn" checked /> Color Palette</label>
                <label><input type="checkbox" id="toggleSaveChatBtn" checked /> Save Chat</label>
                <label><input type="checkbox" id="toggleLogoutBtn" checked /> Logout</label>
                <label><input type="checkbox" id="toggleFormattingBtn" checked /> Formatting</label>
                <label><input type="checkbox" id="toggleMentionBtn" checked /> Mention</label>
                <label><input type="checkbox" id="toggleAttachFileBtn" checked /> Attach File</label>
                <label><input type="checkbox" id="toggleEmojiBtn" checked /> Emoji</label>
                <label><input type="checkbox" id="toggleSendBtn" checked /> Send Button</label>
            </div>
            <div id="admin-search-results"></div>
            <h3>Room Control</h3>
            <div id="admin-room-users"></div>
            <div class="admin-global-message-container">
                <h3>Global Announcement</h3>
                <div id="adminGlobalMessage" contenteditable="true" spellcheck="false" placeholder="Write global message..."></div>
                <div class="admin-global-formatting-toolbar">
                    <button class="tool-button" data-command="bold" title="Bold"><i data-feather="bold"></i></button>
                    <button class="tool-button" data-command="italic" title="Italic"><i data-feather="italic"></i></button>
                    <button class="tool-button" data-command="underline" title="Underline"><i data-feather="underline"></i></button>
                    <button class="tool-button" data-command="strikethrough" title="Strikethrough"><i data-feather="minus"></i></button>
                    <button class="tool-button" data-command="shadow" title="Shadow"><i data-feather="type"></i></button>
                    <button class="tool-button" id="admin-fontSizePlusBtn" title="Increase Font"><i data-feather="plus-circle"></i></button>
                    <button class="tool-button" id="admin-fontSizeMinusBtn" title="Decrease Font"><i data-feather="minus-circle"></i></button>
                    <button class="tool-button" id="admin-highlightBtn" title="Highlight Text"><i data-feather="pen-tool"></i></button>
                    <input type="color" id="admin-highlightPicker" style="display: none;" />
                    <button class="tool-button" id="admin-colorBtn" title="Text Color"><i data-feather="edit-3"></i></button>
                    <input type="color" id="admin-colorPicker" style="display: none;" />
                    <div id="admin-global-sound-selector" style="display: flex; align-items: center; gap: 5px;">
                        <i data-feather="music"></i>
                        <select id="admin-global-sound-select">
                            <option value="none" />None
                            <option value="screamSound" />Scream
                            <option value="applauseSound" />Applause
                            <option value="attentionSound" />Attention
                        </select>
                    </div>
                </div>
                <button id="sendGlobalMessageBtn" style="margin-top: 10px;">Send Global Message</button>
            </div>
        </div>
    </div>

    <script src="https://meu-chat-lin7.onrender.com/socket.io/socket.io.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const socket = io('https://chat-online-theta.vercel.app');

            const chatWindow = document.getElementById('chatWindow');
            const toggleFormattingBtn = document.getElementById('toggleFormattingBtn');
            const formattingPopup = document.getElementById('formatting-popup');
            const roomsBtn = document.getElementById('roomsBtn');
            const roomsModal = document.getElementById('rooms-modal');
            const roomNumberInput = document.getElementById('roomNumberInput');
            const joinRoomBtn = document.getElementById('joinRoomBtn');
            const inviteUserBtn = document.getElementById('inviteUserBtn');
            const inviteModal = document.getElementById('invite-modal');
            const usernameToInviteInput = document.getElementById('usernameToInviteInput');
            const sendInviteBtn = document.getElementById('sendInviteBtn');
            const chatIcon=document.getElementById('chatIcon'),chatScreen=document.getElementById('chatScreen'),screenTitle=document.getElementById('screenTitle'),logoutBtn=document.getElementById('logoutBtn'),backToChatBtn=document.getElementById('backToChatBtn'),messageInput=document.getElementById('messageInput'),sendBtn=document.getElementById('sendBtn'),attachFileBtn=document.getElementById('attachFileBtn'),fileUpload=document.getElementById('fileUpload'),saveChatBtn=document.getElementById('saveChatBtn'),fontSelect=document.getElementById('font-select'),colorBtn=document.getElementById('colorBtn'),colorPicker=document.getElementById('colorPicker'),usernameInput=document.getElementById('usernameInput'),loginBtn=document.getElementById('loginBtn'),reactionPopup=document.getElementById('reaction-popup'),mentionBtn=document.getElementById('mentionBtn');
            
            const adminPanelBtn = document.getElementById('adminPanelBtn');
            const adminPanelModal = document.getElementById('admin-panel-modal');
            const adminStatsDiv = document.getElementById('admin-stats');
            const adminUserInput = document.getElementById('adminUserInput');
            const adminUserSearchBtn = document.getElementById('adminUserSearchBtn');
            const adminRoomInput = document.getElementById('adminRoomInput');
            const adminRoomSearchBtn = document.getElementById('adminRoomSearchBtn');
            const adminSearchResults = document.getElementById('admin-search-results');
            const adminRoomList = document.getElementById('admin-room-list');
            const roomLockBtn = document.getElementById('roomLockBtn');
            const usersOnlineBtn = document.getElementById('usersOnlineBtn');
            const usersOnlineModal = document.getElementById('users-online-modal');
            const usersListDiv = document.getElementById('users-list');
            const alarmBtn = document.getElementById('alarmBtn');
            const alarmModal = document.getElementById('alarm-modal');
            const alarmOptionsDiv = document.getElementById('alarm-options');
            const fontSizePlusBtn = document.getElementById('fontSizePlusBtn');
            const fontSizeMinusBtn = document.getElementById('fontSizeMinusBtn');
            const highlightBtn = document.getElementById('highlightBtn');
            const highlightPicker = document.getElementById('highlightPicker');
            const adminRoomUsersDiv = document.getElementById('admin-room-users');
            const emojiBtn = document.getElementById('emojiBtn');
            const emojiModal = document.getElementById('emoji-modal');
            const emojiPicker = document.getElementById('emoji-picker');
            const audioToggleBtn = document.getElementById('audioToggleBtn');
            const minimizeChatBtn = document.getElementById('minimizeChatBtn');
            const maximizeChatBtn = document.getElementById('maximizeChatBtn');
            const restoreChatBtn = document.getElementById('restoreChatBtn');
            const mobileViewBtn = document.getElementById('mobileViewBtn');
            const colorPaletteBtn = document.getElementById('colorPaletteBtn');
            const chatWallpaperColor = document.getElementById('chatWallpaperColor');
            const toggleRoomsBtn = document.getElementById('toggleRoomsBtn');
            const toggleUsersOnlineBtn = document.getElementById('toggleUsersOnlineBtn');
            const toggleAudioToggleBtn = document.getElementById('toggleAudioToggleBtn');
            const toggleMinimizeChatBtn = document.getElementById('toggleMinimizeChatBtn');
            const toggleMaximizeChatBtn = document.getElementById('toggleMaximizeChatBtn');
            const toggleInviteUserBtn = document.getElementById('toggleInviteUserBtn');
            const toggleAdminPanelBtn = document.getElementById('toggleAdminPanelBtn');
            const toggleRoomLockBtn = document.getElementById('toggleRoomLockBtn');
            const toggleAlarmBtn = document.getElementById('toggleAlarmBtn');
            const toggleColorPaletteBtn = document.getElementById('toggleColorPaletteBtn');
            const toggleSaveChatBtn = document.getElementById('toggleSaveChatBtn');
            const toggleLogoutBtn = document.getElementById('toggleLogoutBtn');
            const toggleFormattingBtnAdmin = document.getElementById('toggleFormattingBtn');
            const toggleMentionBtn = document.getElementById('toggleMentionBtn');
            const toggleAttachFileBtn = document.getElementById('toggleAttachFileBtn');
            const toggleEmojiBtn = document.getElementById('toggleEmojiBtn');
            const toggleSendBtn = document.getElementById('toggleSendBtn');
            
            let currentRoom = 0;
            let currentUser = "Guest", isAudioEnabled = true, messageIdCounter = 0;
            let activeStyles = { bold: false, italic: false, underline: false, strikethrough: false, shadow: false, color: '#000000', fontFamily: 'Roboto', highlight: '' };
            let activeFontSize = 16;
            let adminGlobalStyles = { bold: false, italic: false, underline: false, strikethrough: false, shadow: false, color: '#000000', fontFamily: 'Roboto', highlight: '' };
            let adminGlobalFontSize = 16;
            let adminGlobalSound = 'none';
            let isEditing = false;
            let messageToEditId = null;

            let onlineUsers = {};
            let roomLocks = {};
            let allMessages = {};

            const googleFonts = ['Roboto','Open Sans','Lato','Montserrat','Oswald','Raleway','Poppins','Nunito','Playfair Display','Merriweather','Indie Flower','Dancing Script','Pacifico','Lobster','Source Code Pro','Nunito Sans','Inter','Work Sans','Fira Sans','Source Sans Pro','PT Sans','Ubuntu','Lora','Quicksand','Comfortaa', 'Bebas Neue', 'Kanit', 'Permanent Marker', 'Anton', 'Archivo Black', 'Abril Fatface', 'Josefin Sans', 'Satisfy', 'Courgette', 'Noto Sans', 'Dosis', 'Merriweather Sans', 'Concert One', 'Passion One', 'Barlow', 'Caveat', 'Alfa Slab One', 'Exo 2', 'Secular One'];
            const availableReactions = [{type:'icon',id:'thumbs-up',label:'Like'},{type:'icon',id:'heart',label:'Love'},{type:'icon',id:'smile',label:'Haha'},{type:'icon',id:'star',label:'Wow'},{type:'icon',id:'frown',label:'Sad'},{type:'icon',id:'thumbs-down',label:'No'},{type:'icon',id:'help-circle',label:'Thinking'},{type:'icon',id:'check-circle',label:'Approve'}];
            const reactionSounds = {
                'thumbs-up': new Audio('https://www.soundjay.com/buttons/sounds/button-36.mp3'),
                'heart': new Audio('https://www.soundjay.com/buttons/sounds/button-18.mp3'),
                'smile': new Audio('https://www.soundjay.com/buttons/sounds/button-3.mp3'),
                'star': new Audio('https://www.soundjay.com/buttons/sounds/button-2.mp3'),
                'frown': new Audio('https://www.soundjay.com/buttons/sounds/button-37.mp3'),
                'thumbs-down': new Audio('https://www.soundjay.com/buttons/sounds/button-1.mp3'),
                'help-circle': new Audio('https://www.soundjay.com/buttons/sounds/button-7.mp3'),
                'check-circle': new Audio('https://www.soundjay.com/buttons/sounds/button-23.mp3')
            };
            const globalSounds = {
                'screamSound': new Audio('https://assets.mixkit.co/sfx/preview/mixkit-scream-of-a-man-in-fear-1279.mp3'),
                'applauseSound': new Audio('https://assets.mixkit.co/sfx/preview/mixkit-small-group-of-people-applauding-511.mp3'),
                'attentionSound': new Audio('https://assets.mixkit.co/sfx/preview/mixkit-attention-bell-2759.mp3'),
            };
            const emojis = {
                'ğŸ˜€': ['ğŸ˜€', 'ğŸ˜ƒ', 'ğŸ˜„', 'ğŸ˜', 'ğŸ˜†', 'ğŸ˜…', 'ğŸ¤£', 'ğŸ˜‚', 'ğŸ™‚', 'ğŸ™ƒ', 'ğŸ˜‰', 'ğŸ˜Š', 'ğŸ˜‡', 'ğŸ¥°', 'ğŸ˜', 'ğŸ¤©', 'ğŸ˜˜', 'ğŸ˜—', 'ğŸ˜š', 'ğŸ˜™', 'ğŸ˜‹', 'ğŸ˜›', 'ğŸ˜œ', 'ğŸ¤ª', 'ğŸ˜', 'ğŸ¤—', 'ğŸ¤­', 'ğŸ¤«', 'ğŸ¤”', 'ğŸ¤', 'ğŸ¤¨', 'ğŸ˜', 'ğŸ˜‘', 'ğŸ˜¶', 'ğŸ˜', 'ğŸ˜’', 'ğŸ™„', 'ğŸ˜¬', 'ğŸ¤¥', 'ğŸ˜Œ', 'ğŸ˜”', 'ğŸ˜ª', 'ğŸ¤¤', 'ğŸ˜´', 'ğŸ˜·', 'ğŸ¤’', 'ğŸ¤•', 'ğŸ¤¢', 'ğŸ¤®', 'ğŸ¤§', 'ğŸ¥µ', 'ğŸ¥¶', 'ğŸ¥´', 'ğŸ˜µ', 'ğŸ¤¯', 'ğŸ¤ ', 'ğŸ¥³', 'ğŸ˜', 'ğŸ¤“', 'ğŸ§', 'ğŸ˜•', 'ğŸ˜Ÿ', 'ğŸ™', 'ğŸ˜®', 'ğŸ˜¯', 'ğŸ˜²', 'ğŸ˜³', 'ğŸ¥º', 'ğŸ˜¦', 'ğŸ˜§', 'ğŸ˜¨', 'ğŸ˜°', 'ğŸ˜¥', 'ğŸ˜¢', 'ğŸ˜­', 'ğŸ˜±', 'ğŸ˜–', 'ğŸ˜£', 'ğŸ˜©', 'ğŸ˜«', 'ğŸ˜¡', 'ğŸ˜ ', 'ğŸ˜¤', 'ğŸ¤¬', 'ğŸ˜ˆ', 'ğŸ‘¿', 'ğŸ’€', 'ğŸ‘»', 'ğŸ’©', 'ğŸ¤¡'],
                'ğŸ”': ['ğŸ‡', 'ğŸˆ', 'ğŸ‰', 'ğŸŠ', 'ğŸ‹', 'ğŸŒ', 'ğŸ', 'ğŸ¥­', 'ğŸ', 'ğŸ', 'ğŸ', 'ğŸ‘', 'ğŸ’', 'ğŸ“', 'ğŸ¥', 'ğŸ…', 'ğŸ¥¥', 'ğŸ¥‘', 'ğŸ†', 'ğŸ¥”', 'ğŸ¥•', 'ğŸŒ½', 'ğŸŒ¶ï¸', 'ğŸ¥’', 'ğŸ¥¬', 'ğŸ¥¦', 'ğŸ„', 'ğŸ¥œ', 'ğŸŒ°', 'ğŸ', 'ğŸ¥', 'ğŸ¥–', 'ğŸ¥¨', 'ğŸ¥', 'ğŸ§‡', 'ğŸ§€', 'ğŸ—', 'ğŸ–', 'ğŸ¥©', 'ğŸ¥“', 'ğŸ”', 'ğŸŸ', 'ğŸ•', 'ğŸŒ­', 'ğŸ¥ª', 'ğŸŒ®', 'ğŸŒ¯', 'ğŸ¥™', 'ğŸ³', 'ğŸ¥š', 'ğŸ¥˜', 'ğŸ²', 'ğŸœ', 'ğŸ', 'ğŸ£', 'ğŸ¤', 'ğŸš', 'ğŸ™', 'ğŸ˜', 'ğŸ¥', 'ğŸ¡', 'ğŸ¢', 'ğŸ§', 'ğŸ¨', 'ğŸ¦', 'ğŸ¥§', 'ğŸ°', 'ğŸ‚', 'ğŸ®', 'ğŸ¬', 'ğŸ­', 'ğŸ«', 'ğŸ¿', 'ğŸ©', 'ğŸª', 'ğŸ¥›', 'â˜•', 'ğŸµ', 'ğŸ¶', 'ğŸ¾', 'ğŸ·', 'ğŸ¸', 'ğŸ¹', 'ğŸº', 'ğŸ»', 'ğŸ¥‚', 'ğŸ¥ƒ', 'ğŸ¥¤', 'ğŸ§ƒ'],
                'ğŸ¶': ['ğŸ¶', 'ğŸ±', 'ğŸ­', 'ğŸ¹', 'ğŸ°', 'ğŸ¦Š', 'ğŸ»', 'ğŸ¼', 'ğŸ¨', 'ğŸ¯', 'ğŸ¦', 'ğŸ®', 'ğŸ·', 'ğŸ¸', 'ğŸµ', 'ğŸ”', 'ğŸ§', 'ğŸ¦', 'ğŸ¦‰', 'ğŸ¦†', 'ğŸ¦…', 'ğŸ¦‹', 'ğŸ›', 'ğŸ', 'ğŸ', 'ğŸ¢', 'ğŸ', 'ğŸ¦•', 'ğŸ¦–', 'ğŸ™', 'ğŸ¦‘', 'ğŸ¦€', 'ğŸ¦', 'ğŸ¦', 'ğŸ ', 'ğŸŸ', 'ğŸ¡', 'ğŸ¬', 'ğŸ³', 'ğŸ¦ˆ', 'ğŸŠ', 'ğŸ…', 'ğŸ†', 'ğŸ¦“', 'ğŸ¦’', 'ğŸ˜', 'ğŸ¦', 'ğŸª', 'ğŸ«', 'ğŸ¦˜', 'ğŸƒ', 'ğŸ‚', 'ğŸ„', 'ğŸ–', 'ğŸ', 'ğŸ‘', 'ğŸ', 'ğŸ¦Œ', 'ğŸ', 'ğŸ´', 'ğŸ¦„', 'ğŸ•Šï¸', 'ğŸ¾', 'ğŸŒ³', 'ğŸŒ²', 'ğŸŒ´', 'ğŸŒµ', 'ğŸŒ·', 'ğŸŒ¸', 'ğŸŒ¹', 'ğŸŒ»', 'ğŸŒ¼', 'ğŸŒº', 'ğŸŒ¾', 'ğŸ', 'ğŸ‚', 'ğŸ„'],
                'ğŸš—': ['âš½', 'ğŸ€', 'ğŸˆ', 'âš¾', 'ğŸ¾', 'ğŸ', 'ğŸ‰', 'ğŸ±', 'ğŸ“', 'ğŸ¸', 'ğŸ’', 'ğŸ¥', 'ğŸ‘', 'ğŸ¹', 'ğŸ£', 'ğŸ¥Š', 'ğŸ¥‹', 'ğŸ¿', 'ğŸ‚', 'ğŸ›·', 'â›¸ï¸', 'ğŸ¥Œ', 'ğŸ½', 'ğŸ¤¸', 'ğŸ‹ï¸', 'â›¹ï¸', 'ğŸ¤º', 'ğŸŒï¸', 'ğŸ„', 'ğŸŠ', 'ğŸ¤½', 'ğŸš£', 'ğŸ‡', 'ğŸš´', 'ğŸšµ', 'ğŸ›£ï¸', 'ğŸ›¤ï¸', 'ğŸš¢', 'ğŸ›³ï¸', 'â›µ', 'ğŸš¤', 'ğŸ›¥ï¸', 'ğŸš€', 'ğŸš', 'âœˆï¸', 'ğŸ›«', 'ğŸ›¬', 'ğŸšŠ', 'ğŸš‚', 'ğŸšƒ', 'ğŸš„', 'ğŸš…', 'ğŸš†', 'ğŸš‡', 'ğŸšˆ', 'ğŸš‰', 'ğŸš', 'ğŸšŒ', 'ğŸš', 'ğŸš‘', 'ğŸš’', 'ğŸš“', 'ğŸš•', 'ğŸš–', 'ğŸš—', 'ğŸš™', 'ğŸšš', 'ğŸš›', 'ğŸšœ', 'ğŸ›µ', 'ğŸš²', 'ğŸ›´', 'ğŸ—ºï¸', 'ğŸ“', 'ğŸ§­'],
                'ğŸ’¡': ['âŒš', 'ğŸ“±', 'ğŸ“²', 'ğŸ’»', 'ğŸ–¥ï¸', 'âŒ¨ï¸', 'ğŸ–±ï¸', 'ğŸ’½', 'ğŸ’¾', 'ğŸ’¿', 'ğŸ“€', 'ğŸ§®', 'ğŸ“¹', 'ğŸ“·', 'ğŸ“¸', 'ğŸ“½ï¸', 'ğŸ¥', 'ğŸ¬', 'ğŸ“', 'â˜ï¸', 'ğŸ“Ÿ', 'ğŸ“ ', 'ğŸ”Œ', 'ğŸ”‹', 'ğŸ—‘ï¸', 'ğŸ›¢ï¸', 'ğŸ”¦', 'ğŸ’¡', 'ğŸ”¦', 'ğŸ“–', 'ğŸ“š', 'ğŸ“œ', 'ğŸ“°', 'ğŸ—ï¸', 'ğŸ”–', 'ğŸ·ï¸', 'ğŸ’°', 'ğŸ’µ', 'ğŸ’³', 'ğŸ’', 'ğŸ”‘', 'ğŸ”“', 'ğŸ”', 'ğŸ”’', 'ğŸ”', 'ğŸ”‘', 'ğŸ”¨', 'âš’ï¸', 'â›ï¸', 'ğŸ”©', 'âš™ï¸', 'ğŸ”§', 'â›“ï¸', 'ğŸ§°', 'ğŸ§±', 'ğŸšª', 'ğŸª‘', 'ğŸ›‹ï¸', 'ğŸ›ï¸', 'ğŸ›', 'ğŸš¿', 'ğŸš½', 'ğŸª ', 'ğŸ””', 'ğŸ”•', 'ğŸ“¢', 'ğŸ“£', 'ğŸ“¯', 'ğŸ¶', 'ğŸ¼', 'ğŸµ', 'ğŸ™ï¸', 'ğŸ¤', 'ğŸ§', 'ğŸ“»', 'ğŸ“º', 'ğŸ“»', 'ğŸ', 'ğŸ€', 'ğŸ‰', 'ğŸŠ', 'ğŸˆ', 'ğŸ“§', 'âœ‰ï¸', 'ğŸ“¦', 'ğŸ“¤', 'ğŸ“¥', 'ğŸ“«', 'ğŸ“ª', 'ğŸ“¬', 'ğŸ“­', 'ğŸ“®'],
                'ğŸ‡§ğŸ‡·': ['ğŸ‡§ğŸ‡·', 'ğŸ‡ºğŸ‡¸', 'ğŸ‡ªğŸ‡¸', 'ğŸ‡«ğŸ‡·', 'ğŸ‡©ğŸ‡ª', 'ğŸ‡®ğŸ‡¹', 'ğŸ‡¯ğŸ‡µ', 'ğŸ‡¨ğŸ‡³', 'ğŸ‡·ğŸ‡º', 'ğŸ‡®ğŸ‡³', 'ğŸ‡¦ğŸ‡·', 'ğŸ‡¨ğŸ‡¦', 'ğŸ‡²ğŸ‡½', 'ğŸ‡µğŸ‡¹', 'ğŸ‡¬ğŸ‡§', 'ğŸ‡°ğŸ‡·', 'ğŸ‡¦ğŸ‡º', 'ğŸ‡¿ğŸ‡¦', 'ğŸ‡ªğŸ‡¬', 'ğŸ‡¸ğŸ‡¦', 'ğŸ‡¹ğŸ‡·', 'ğŸ‡µğŸ‡±', 'ğŸ‡®ğŸ‡©', 'ğŸ‡¹ğŸ‡­', 'ğŸ‡»ğŸ‡³', 'ğŸ‡³ğŸ‡¬', 'ğŸ‡¨ğŸ‡´', 'ğŸ‡µğŸ‡°', 'ğŸ‡©ğŸ‡¿', 'ğŸ‡®ğŸ‡¶', 'ğŸ‡ºğŸ‡¦', 'ğŸ‡¨ğŸ‡­', 'ğŸ‡³ğŸ‡±', 'ğŸ‡§ğŸ‡ª', 'ğŸ‡¸ğŸ‡ª', 'ğŸ‡³ğŸ‡´', 'ğŸ‡«ğŸ‡®', 'ğŸ‡©ğŸ‡°', 'ğŸ‡®ğŸ‡ª', 'ğŸ‡¬ğŸ‡·', 'ğŸ‡¨ğŸ‡±', 'ğŸ‡µğŸ‡ª', 'ğŸ‡ªğŸ‡¨', 'ğŸ‡»ğŸ‡ª', 'ğŸ‡ºğŸ‡¾', 'ğŸ‡µğŸ‡¾', 'ğŸ‡§ğŸ‡´', 'ğŸ‡¦ğŸ‡ª', 'ğŸ‡¶ğŸ‡¦', 'ğŸ‡°ğŸ‡¼', 'ğŸ‡®ğŸ‡±', 'ğŸ‡¹ğŸ‡¼', 'ğŸ‡¸ğŸ‡¬', 'ğŸ‡²ğŸ‡¾', 'ğŸ‡µğŸ‡­', 'ğŸ‡®ğŸ‡¨', 'ğŸ‡­ğŸ‡·', 'ğŸ‡·ğŸ‡´', 'ğŸ‡¨ğŸ‡¿', 'ğŸ‡­ğŸ‡º', 'ğŸ‡§ğŸ‡¬', 'ğŸ‡¦ğŸ‡¹', 'ğŸ‡¸ğŸ‡°', 'ğŸ‡¸ğŸ‡®', 'ğŸ‡±ğŸ‡»', 'ğŸ‡ªğŸ‡ª', 'ğŸ‡±ğŸ‡¹', 'ğŸ‡²ğŸ‡¹', 'ğŸ‡¨ğŸ‡¾', 'ğŸ‡¦ğŸ‡±', 'ğŸ‡§ğŸ‡¦', 'ğŸ‡²ğŸ‡ª', 'ğŸ‡²ğŸ‡°', 'ğŸ‡½ğŸ‡°', 'ğŸ‡·ğŸ‡¸', 'ğŸ‡¨ğŸ‡¿', 'ğŸ‡¬ğŸ‡ª', 'ğŸ‡¦ğŸ‡²', 'ğŸ‡¦ğŸ‡¿', 'ğŸ‡°ğŸ‡¿', 'ğŸ‡ºğŸ‡¿', 'ğŸ‡¹ğŸ‡²', 'ğŸ‡¹ğŸ‡¯', 'ğŸ‡°ğŸ‡¬', 'ğŸ‡±ğŸ‡°', 'ğŸ‡§ğŸ‡©', 'ğŸ‡³ğŸ‡µ', 'ğŸ‡²ğŸ‡²', 'ğŸ‡°ğŸ‡­', 'ğŸ‡±ğŸ‡¦', 'ğŸ‡µğŸ‡¬', 'ğŸ‡«ğŸ‡¯', 'ğŸ‡³ğŸ‡¿', 'ğŸ‡¼ğŸ‡¸', 'ğŸ‡¹ğŸ‡´', 'ğŸ‡¹ğŸ‡»', 'ğŸ‡°ğŸ‡®', 'ğŸ‡²ğŸ‡­', 'ğŸ‡«ğŸ‡²', 'ğŸ‡µğŸ‡¼', 'ğŸ‡¸ğŸ‡§', 'ğŸ‡»ğŸ‡º', 'ğŸ‡¦ğŸ‡®', 'ğŸ‡¦ğŸ‡¶', 'ğŸ‡¦ğŸ‡¸', 'ğŸ‡¦ğŸ‡¼', 'ğŸ‡¦ğŸ‡½', 'ğŸ‡§ğŸ‡§', 'ğŸ‡§ğŸ‡²', 'ğŸ‡§ğŸ‡¼', 'ğŸ‡¨ğŸ‡©', 'ğŸ‡¨ğŸ‡«', 'ğŸ‡¨ğŸ‡¬', 'ğŸ‡¨ğŸ‡®', 'ğŸ‡¨ğŸ‡°', 'ğŸ‡¨ğŸ‡½', 'ğŸ‡¨ğŸ‡¿', 'ğŸ‡ªğŸ‡­', 'ğŸ‡ªğŸ‡·', 'ğŸ‡ªğŸ‡¹', 'ğŸ‡«ğŸ‡´', 'ğŸ‡¬ğŸ‡¦', 'ğŸ‡¬ğŸ‡©', 'ğŸ‡¬ğŸ‡«', 'ğŸ‡¬ğŸ‡¬', 'ğŸ‡¬ğŸ‡­', 'ğŸ‡¬ğŸ‡®', 'ğŸ‡¬ğŸ‡±', 'ğŸ‡¬ğŸ‡²', 'ğŸ‡¬ğŸ‡¼', 'ğŸ‡¬ğŸ‡¾', 'ğŸ‡­ğŸ‡°', 'ğŸ‡®ğŸ‡´', 'ğŸ‡¯ğŸ‡ª', 'ğŸ‡°ğŸ‡ª', 'ğŸ‡°ğŸ‡²', 'ğŸ‡±ğŸ‡¨', 'ğŸ‡±ğŸ‡®', 'ğŸ‡²ğŸ‡¬', 'ğŸ‡²ğŸ‡·', 'ğŸ‡²ğŸ‡º', 'ğŸ‡²ğŸ‡¼', 'ğŸ‡²ğŸ‡½', 'ğŸ‡²ğŸ‡¾', 'ğŸ‡²ğŸ‡¿', 'ğŸ‡³ğŸ‡¦', 'ğŸ‡³ğŸ‡¨', 'ğŸ‡³ğŸ‡ª', 'ğŸ‡³ğŸ‡«', 'ğŸ‡³ğŸ‡¬', 'ğŸ‡³ğŸ‡±', 'ğŸ‡³ğŸ‡´', 'ğŸ‡³ğŸ‡µ', 'ğŸ‡³ğŸ‡·', 'ğŸ‡³ğŸ‡º', 'ğŸ‡³ğŸ‡¿', 'ğŸ‡´ğŸ‡²', 'ğŸ‡µğŸ‡¦', 'ğŸ‡µğŸ‡ª', 'ğŸ‡µğŸ‡«', 'ğŸ‡µğŸ‡¬', 'ğŸ‡µğŸ‡­', 'ğŸ‡µğŸ‡°', 'ğŸ‡µğŸ‡±', 'ğŸ‡µğŸ‡²', 'ğŸ‡µğŸ‡³', 'ğŸ‡µğŸ‡·', 'ğŸ‡µğŸ‡¸', 'ğŸ‡µğŸ‡¹', 'ğŸ‡µğŸ‡¼', 'ğŸ‡µğŸ‡¾', 'ğŸ‡¶ğŸ‡¦', 'ğŸ‡·ğŸ‡ª', 'ğŸ‡·ğŸ‡´', 'ğŸ‡·ğŸ‡¸', 'ğŸ‡·ğŸ‡º', 'ğŸ‡·ğŸ‡¼', 'ğŸ‡¸ğŸ‡¦', 'ğŸ‡¸ğŸ‡§', 'ğŸ‡¸ğŸ‡¨', 'ğŸ‡¸ğŸ‡©', 'ğŸ‡¸ğŸ‡ª', 'ğŸ‡¸ğŸ‡¬', 'ğŸ‡¸ğŸ‡­', 'ğŸ‡¸ğŸ‡®', 'ğŸ‡¸ğŸ‡°', 'ğŸ‡¸ğŸ‡±', 'ğŸ‡¸ğŸ‡²', 'ğŸ‡¸ğŸ‡³', 'ğŸ‡¸ğŸ‡´', 'ğŸ‡¸ğŸ‡·', 'ğŸ‡¸ğŸ‡¸', 'ğŸ‡¸ğŸ‡¹', 'ğŸ‡¸ğŸ‡»', 'ğŸ‡¸ğŸ‡½', 'ğŸ‡¸ğŸ‡¾', 'ğŸ‡¸ğŸ‡¿', 'ğŸ‡¹ğŸ‡¨', 'ğŸ‡¹ğŸ‡©', 'ğŸ‡¹ğŸ‡«', 'ğŸ‡¹ğŸ‡¬', 'ğŸ‡¹ğŸ‡­', 'ğŸ‡¹ğŸ‡¯', 'ğŸ‡¹ğŸ‡°', 'ğŸ‡¹ğŸ‡±', 'ğŸ‡¹ğŸ‡²', 'ğŸ‡¹ğŸ‡³', 'ğŸ‡¹ğŸ‡´', 'ğŸ‡¹ğŸ‡·', 'ğŸ‡¹ğŸ‡¹', 'ğŸ‡¹ğŸ‡»', 'ğŸ‡¹ğŸ‡¼', 'ğŸ‡¹ğŸ‡¿', 'ğŸ‡ºğŸ‡¦', 'ğŸ‡ºğŸ‡¬', 'ğŸ‡ºğŸ‡²', 'ğŸ‡ºğŸ‡³', 'ğŸ‡ºğŸ‡¸', 'ğŸ‡ºğŸ‡¾', 'ğŸ‡ºğŸ‡¿', 'ğŸ‡»ğŸ‡¦', 'ğŸ‡»ğŸ‡¨', 'ğŸ‡»ğŸ‡ª', 'ğŸ‡»ğŸ‡¬', 'ğŸ‡»ğŸ‡®', 'ğŸ‡»ğŸ‡³', 'ğŸ‡»ğŸ‡º', 'ğŸ‡¼ğŸ‡«', 'ğŸ‡¼ğŸ‡¸', 'ğŸ‡½ğŸ‡°', 'ğŸ‡¾ğŸ‡ª', 'ğŸ‡¾ğŸ‡¹', 'ğŸ‡¿ğŸ‡¦', 'ğŸ‡¿ğŸ‡²', 'ğŸ‡¿ğŸ‡¼']
Â Â Â Â Â Â Â Â Â Â Â  };
Â Â Â Â Â Â Â Â Â Â Â  let chatState = { mode: 'main', withUser: null };
Â Â Â Â Â Â Â Â Â Â Â  let userAlarmCounts = {};
Â Â Â Â Â Â Â Â Â Â  Â 
Â Â Â Â Â Â Â Â Â Â Â  const messageSound = new Audio('https://www.soundjay.com/buttons/button-10.mp3');
Â Â Â Â Â Â Â Â Â Â Â  const applauseSound = new Audio('https://assets.mixkit.co/sfx/preview/mixkit-small-group-of-people-applauding-511.mp3');
Â Â Â Â Â Â Â Â Â Â Â  const screamSound = new Audio('https://assets.mixkit.co/sfx/preview/mixkit-scream-of-a-man-in-fear-1279.mp3');
Â Â Â Â Â Â Â Â Â Â Â  const attentionSound = new Audio('https://assets.mixkit.co/sfx/preview/mixkit-attention-bell-2759.mp3');
Â Â Â Â Â Â Â Â Â Â Â  const thumbsUpSound = new Audio('https://www.soundjay.com/buttons/sounds/button-36.mp3');
Â Â Â Â Â Â Â Â Â Â Â  const heartSound = new Audio('https://www.soundjay.com/buttons/sounds/button-18.mp3');
Â Â Â Â Â Â Â Â Â Â Â  const smileSound = new Audio('https://www.soundjay.com/buttons/sounds/button-3.mp3');
Â Â Â Â Â Â Â Â Â Â Â  const starSound = new Audio('https://www.soundjay.com/buttons/sounds/button-2.mp3');
Â Â Â Â Â Â Â Â Â Â Â  const frownSound = new Audio('https://www.soundjay.com/buttons/sounds/button-37.mp3');
Â Â Â Â Â Â Â Â Â Â Â  const thumbsDownSound = new Audio('https://www.soundjay.com/buttons/sounds/button-1.mp3');
Â Â Â Â Â Â Â Â Â Â Â  const helpCircleSound = new Audio('https://www.soundjay.com/buttons/sounds/button-7.mp3');
Â Â Â Â Â Â Â Â Â Â Â  const checkCircleSound = new Audio('https://www.soundjay.com/buttons/sounds/button-23.mp3');

Â Â Â Â Â Â Â Â Â Â Â  setInterval(() => { userAlarmCounts = {}; }, 3600000);

Â Â Â Â Â Â Â Â Â Â Â  function updateAdminStats() {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const totalUsers = Object.keys(onlineUsers).length;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const activeRooms = new Set(Object.values(onlineUsers).map(u => u.room));
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  adminStatsDiv.innerHTML = `<b>Online Users:</b> ${totalUsers}`;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â  Â 
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  adminRoomList.innerHTML = `<h3>Active Rooms:</h3><ul>${Array.from(activeRooms).map(room => `<li>Room ${room} ${roomLocks[room] ? '(Locked)' : ''}</li>`).join('')}</ul>`;
Â Â Â Â Â Â Â Â Â Â Â  }
Â Â Â Â Â Â Â Â Â Â  Â 
Â Â Â Â Â Â Â Â Â Â Â  function updateAdminRoomUsers() {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const usersInCurrentRoom = Object.values(onlineUsers).filter(data => data.room === currentRoom);
Â Â Â Â Â Â Â Â Â Â Â Â Â Â  Â 
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  let usersHtml = '<h3>Users in Room:</h3>';
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  if (usersInCurrentRoom.length > 0) {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  usersHtml += `<div class="admin-user-list"><ul>${usersInCurrentRoom.map(user => `<li>${user.username} <button data-user-to-kick="${user.username}">Kick</button></li>`).join('')}</ul></div>`;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  } else {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  usersHtml += '<p>No other users in this room.</p>';
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  }
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  adminRoomUsersDiv.innerHTML = usersHtml;
Â Â Â Â Â Â Â Â Â Â Â  }

Â Â Â Â Â Â Â Â Â Â Â  adminRoomUsersDiv.addEventListener('click', e => {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const button = e.target.closest('button');
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  if (button && button.dataset.userToKick) {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const userToKick = button.dataset.userToKick;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  if (confirm(`Are you sure you want to kick ${userToKick}?`)) {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  socket.emit('kick_user', userToKick);
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  }
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  }
Â Â Â Â Â Â Â Â Â Â Â  });
Â Â Â Â Â Â Â Â Â Â  Â 
Â Â Â Â Â Â Â Â Â Â Â  function searchUserByName() {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const userToFind = adminUserInput.value.trim();
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  if (userToFind) {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  socket.emit('search_user', userToFind);
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  }
Â Â Â Â Â Â Â Â Â Â Â  }

Â Â Â Â Â Â Â Â Â Â Â  function searchRoomContents() {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const roomToFind = parseInt(adminRoomInput.value);
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  if (!isNaN(roomToFind)) {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  socket.emit('search_room', roomToFind);
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  }
Â Â Â Â Â Â Â Â Â Â Â  }
Â Â Â Â Â Â Â Â Â Â  Â 
Â Â Â Â Â Â Â Â Â Â Â  function toggleRoomLock() {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  socket.emit('admin_toggle_lock', currentRoom);
Â Â Â Â Â Â Â Â Â Â Â  }

Â Â Â Â Â Â Â Â Â Â Â  function displaySystemMessage(message) {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const e = document.createElement('div');
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  e.className = 'system-message';
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  e.textContent = message;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  chatScreen.appendChild(e);
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  chatScreen.scrollTop = chatScreen.scrollHeight;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  if (isAudioEnabled) messageSound.play();
Â Â Â Â Â Â Â Â Â Â Â  }

Â Â Â Â Â Â Â Â Â Â Â  function displayInviteMessage(inviterName, roomNumber) {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const inviteDiv = document.createElement('div');
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  inviteDiv.className = 'invite-message';
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  inviteDiv.innerHTML = `<p><b>${inviterName}</b> invited you to join <b>Room ${roomNumber}</b>.</p><button class="invite-accept-btn" data-room="${roomNumber}">Yes</button><button class="invite-decline-btn decline">No</button>`;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  chatScreen.appendChild(inviteDiv);
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  chatScreen.scrollTop = chatScreen.scrollHeight;
Â Â Â Â Â Â Â Â Â Â Â  }

Â Â Â Â Â Â Â Â Â Â Â  function displayGlobalMessage(message) {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const e = document.createElement('div');
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  e.className = 'global-message';
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  e.innerHTML = `<b>Global Announcement:</b><br>${message.content}`;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  chatScreen.appendChild(e);
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  chatScreen.scrollTop = chatScreen.scrollHeight;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â  Â 
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  if (isAudioEnabled && message.sound !== 'none' && globalSounds[message.sound]) {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const sound = globalSounds[message.sound];
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  sound.currentTime = 0;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  sound.play();
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  }
Â Â Â Â Â Â Â Â Â Â Â  }

Â Â Â Â Â Â Â Â Â Â Â  function applyFormatting(text, styles) {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  let s = text;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  if (styles.bold) s = `<b>${s}</b>`;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  if (styles.italic) s = `<i>${s}</i>`;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  if (styles.underline) s = `<u>${s}</u>`;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  if (styles.strikethrough) s = `<s>${s}</s>`;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  if (styles.highlight) s = `<span style="background-color: ${styles.highlight};">${s}</span>`;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  let style = `font-size: ${styles.fontSize}px; color: ${styles.color}; font-family: '${styles.fontFamily}', sans-serif;`;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  if (styles.shadow) style += ' text-shadow: 1px 1px 1px rgba(0,0,0,0.4);';
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  return `<span style="${style}">${s}</span>`;
Â Â Â Â Â Â Â Â Â Â Â  }

Â Â Â Â Â Â Â Â Â Â Â  function getCurrentTime(timestamp) {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const now = new Date(timestamp);
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const options = {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  year: '2-digit',
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  month: '2-digit',
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  day: '2-digit',
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  hour: '2-digit',
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  minute: '2-digit',
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  second: '2-digit',
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  hour12: true,
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  timeZone: 'America/Vancouver'
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  };
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const formatter = new Intl.DateTimeFormat('en-US', options);
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const formattedTime = formatter.format(now).replace(',', '');
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  return `[${formattedTime} SLT]`;
Â Â Â Â Â Â Â Â Â Â Â  }

Â Â Â Â Â Â Â Â Â Â Â  function createMessageElement(messageData, isMyMessage = false) {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const id = messageData.id;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const messageDiv = document.createElement('div');
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  messageDiv.id = id;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  messageDiv.className = 'chat-message';
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  if (isMyMessage) messageDiv.classList.add('my-message');
Â Â Â Â Â Â Â Â Â Â Â Â Â Â  Â 
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  let displayName = messageData.username;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  let adminStar = '';
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const userObj = Object.values(onlineUsers).find(u => u.username === messageData.username);
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  if (userObj && userObj.isAdmin) {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  displayName = `<b>${messageData.username}</b>`;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  adminStar = '<i data-feather="star" class="admin-star"></i>';
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  }
Â Â Â Â Â Â Â Â Â Â Â Â Â Â  Â 
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const headerDiv = document.createElement('div');
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  headerDiv.style.display = 'flex';
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  headerDiv.style.alignItems = 'center';
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  headerDiv.innerHTML = `${adminStar}<b>${displayName}:</b>`;

Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const contentDiv = document.createElement('div');
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  contentDiv.innerHTML = messageData.content;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â  Â 
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const timestampSpan = document.createElement('span');
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  timestampSpan.className = 'timestamp';
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  timestampSpan.textContent = getCurrentTime(messageData.timestamp);

Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const reactionsWrapper = document.createElement('div');
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  reactionsWrapper.className = 'reactions-display';
Â Â Â Â Â Â Â Â Â Â Â Â Â Â  Â 
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  messageDiv.appendChild(headerDiv);
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  messageDiv.appendChild(contentDiv);
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  messageDiv.appendChild(timestampSpan);
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  messageDiv.appendChild(reactionsWrapper);
Â Â Â Â Â Â Â Â Â Â Â Â Â Â  Â 
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  chatScreen.appendChild(messageDiv);
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  chatScreen.scrollTop = chatScreen.scrollHeight;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  feather.replace();
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  if (isAudioEnabled) {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  messageSound.currentTime = 0;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  messageSound.play();
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  }
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  if (allMessages[messageData.id] && allMessages[messageData.id].reactions) {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  updateReactionsDisplay(messageData.id, allMessages[messageData.id].reactions);
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  }
Â Â Â Â Â Â Â Â Â Â Â  }

Â Â Â Â Â Â Â Â Â Â Â  function renderAllMessages() {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  chatScreen.innerHTML = '';
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const currentRoomMessages = Object.values(allMessages).filter(m => {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const sender = Object.values(onlineUsers).find(u => u.username === m.username);
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  return sender && sender.room === currentRoom;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  });
Â Â Â Â Â Â Â Â Â Â Â Â Â Â  Â 
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  currentRoomMessages.forEach(msg => {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const isMyMessage = msg.username === currentUser.replace(' (Admin)', '');
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  createMessageElement(msg, isMyMessage);
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  });
Â Â Â Â Â Â Â Â Â Â Â  }
Â Â Â Â Â Â Â Â Â Â  Â 
Â Â Â Â Â Â Â Â Â Â Â  function linkify(text) {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const urlRegex = /(\b(https?|ftp|file):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])|(\bwww\.[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/ig;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  return text.replace(urlRegex, url => `<a href="${url.startsWith('http')?url:'https://'+url}" target="_blank">${url}</a>`);
Â Â Â Â Â Â Â Â Â Â Â  }

Â Â Â Â Â Â Â Â Â Â Â  function sendMessage() {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  if (messageInput.textContent.trim() === "") return;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const formattedText = applyFormatting(linkify(messageInput.innerHTML), activeStyles);

Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  if (isEditing) {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  socket.emit('edit_message', {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  id: messageToEditId,
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  content: formattedText
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  });
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  isEditing = false;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  messageToEditId = null;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  sendBtn.innerHTML = '<i data-feather="send"></i>';
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  } else {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  socket.emit('send_message', {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  content: formattedText,
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  styles: activeStyles,
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  fontSize: activeFontSize
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  });
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  }

Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  messageInput.innerHTML = '';
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  messageInput.focus();
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  feather.replace();
Â Â Â Â Â Â Â Â Â Â Â  }
Â Â Â Â Â Â Â Â Â Â  Â 
Â Â Â Â Â Â Â Â Â Â Â  function updateHeaderUI(){
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const chatScreenActive=document.getElementById('chatScreen').classList.contains('active'),loginScreenActive=document.getElementById('loginScreen').classList.contains('active');
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  backToChatBtn.style.display=chatState.mode==='private'?'flex':'none';
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  roomsBtn.style.display=chatScreenActive&&chatState.mode==='main'?'flex':'none';
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  logoutBtn.style.display=loginScreenActive?'none':'flex';
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  inviteUserBtn.style.display=chatScreenActive&&currentRoom>0?'flex':'none';
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  adminPanelBtn.style.display = currentUser.includes('(Admin)') && !loginScreenActive ? 'flex' : 'none';
Â Â Â Â Â Â Â Â Â Â Â Â Â Â  Â 
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  roomLockBtn.style.display = currentUser.includes('(Admin)') && chatScreenActive && currentRoom !== 0 ? 'flex' : 'none';
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const icon = roomLockBtn.querySelector('i');
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  if (icon) {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  if (roomLocks[currentRoom]) {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  icon.setAttribute('data-feather', 'lock');
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  } else {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  icon.setAttribute('data-feather', 'unlock');
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  }
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  }
Â Â Â Â Â Â Â Â Â Â Â Â Â Â  Â 
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  usersOnlineBtn.style.display = chatScreenActive ? 'flex' : 'none';
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  alarmBtn.style.display = chatScreenActive ? 'flex' : 'none';
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  saveChatBtn.style.display = chatScreenActive ? 'flex' : 'none';
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  colorPaletteBtn.style.display = chatScreenActive ? 'flex' : 'none';
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  mobileViewBtn.style.display = !chatWindow.classList.contains('mobile-view') && !loginScreenActive ? 'flex' : 'none';
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  audioToggleBtn.style.display = !loginScreenActive ? 'flex' : 'none';
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  minimizeChatBtn.style.display = 'none';
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  maximizeChatBtn.style.display = !chatWindow.classList.contains('maximized') && !loginScreenActive ? 'flex' : 'none';
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  restoreChatBtn.style.display = chatWindow.classList.contains('maximized') && !loginScreenActive ? 'flex' : 'none';

Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  if(loginScreenActive){
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  screenTitle.innerText='Login';
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  } else if (chatState.mode==='private'){
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  screenTitle.innerText=`Chat with ${chatState.withUser}`;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  } else {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  screenTitle.innerText=`Chat - Room ${currentRoom}`;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  }
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  feather.replace();
Â Â Â Â Â Â Â Â Â Â Â  }
Â Â Â Â Â Â Â Â Â Â  Â 
Â Â Â Â Â Â Â Â Â Â Â  function showScreen(screenId){
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  document.querySelectorAll(".screen").forEach(s=>s.classList.remove("active"));
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  document.getElementById(screenId).classList.add("active");
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  document.getElementById('chatFooter').style.display=screenId==='chatScreen'?'flex':'none';
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  updateHeaderUI();
Â Â Â Â Â Â Â Â Â Â Â  }

Â Â Â Â Â Â Â Â Â Â Â  function login() {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  let username = usernameInput.value.trim();
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  if (username === "") return void alert("Please enter a username.");
Â Â Â Â Â Â Â Â Â Â Â Â Â Â  Â 
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const allowedCharsRegex = /^[a-zA-Z0-9.\-]+$/;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  if (!allowedCharsRegex.test(username)) {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  return void alert("The username can only contain letters, numbers, one period, or one hyphen, without accents.");
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  }
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const dotOrHyphenCount = (username.match(/[\.\-]/g) || []).length;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  if (dotOrHyphenCount > 1) {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  return void alert("The username can only contain one period or one hyphen.");
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  }
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  if (username.includes('.') && username.includes('-')) {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  return void alert("The username can only contain one period or one hyphen, not both.");
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  }
Â Â Â Â Â Â Â Â Â Â Â Â Â Â  Â 
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  socket.emit('login', username);
Â Â Â Â Â Â Â Â Â Â Â  }

Â Â Â Â Â Â Â Â Â Â Â  function startMainChat(){
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  chatScreen.innerHTML = '';
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  chatState={mode:'main',withUser:null};
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  renderAllMessages();
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  updateHeaderUI();
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  showScreen('chatScreen');
Â Â Â Â Â Â Â Â Â Â Â  }
Â Â Â Â Â Â Â Â Â Â  Â 
Â Â Â Â Â Â Â Â Â Â Â  function changeRoom(newRoomStr) {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const newRoom = parseInt(newRoomStr);
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  if (isNaN(newRoom) || newRoom < 0) return alert("Invalid room number.");
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  if (newRoom === currentRoom) return;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â  Â 
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  currentRoom = newRoom;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  socket.emit('join_room', newRoom);
Â Â Â Â Â Â Â Â Â Â Â  }
Â Â Â Â Â Â Â Â Â Â  Â 
Â Â Â Â Â Â Â Â Â Â Â  socket.on('initial_data', (data) => {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  onlineUsers = data.users.reduce((acc, user) => { acc[user.username] = user; return acc; }, {});
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  Object.assign(roomLocks, data.roomLocks);
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  allMessages = data.messages;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  renderAllMessages();
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  updateHeaderUI();
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  updateAdminStats();
Â Â Â Â Â Â Â Â Â Â Â  });

Â Â Â Â Â Â Â Â Â Â Â  socket.on('login_success', (data) => {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  currentUser = data.username;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  if (data.isAdmin) {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  currentUser += ' (Admin)';
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  }
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  startMainChat();
Â Â Â Â Â Â Â Â Â Â Â  });

Â Â Â Â Â Â Â Â Â Â Â  socket.on('login_error', (message) => {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  alert(message);
Â Â Â Â Â Â Â Â Â Â Â  });
Â Â Â Â Â Â Â Â Â Â  Â 
Â Â Â Â Â Â Â Â Â Â Â  socket.on('admin_login_challenge', () => {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const password = prompt("Restricted access. Please enter the Admin password:");
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  socket.emit('admin_password_submit', password);
Â Â Â Â Â Â Â Â Â Â Â  });
Â Â Â Â Â Â Â Â Â Â  Â 
Â Â Â Â Â Â Â Â Â Â Â  socket.on('kick_success', () => {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  alert('You have been kicked by an admin.');
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  location.reload();
Â Â Â Â Â Â Â Â Â Â Â  });

Â Â Â Â Â Â Â Â Â Â Â  socket.on('update_data', (data) => {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  onlineUsers = data.users.reduce((acc, user) => { acc[user.username] = user; return acc; }, {});
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  Object.assign(roomLocks, data.roomLocks);
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  allMessages = data.messages;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  renderAllMessages();
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  updateHeaderUI();
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  updateAdminStats();
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  updateAdminRoomUsers();
Â Â Â Â Â Â Â Â Â Â Â  });

Â Â Â Â Â Â Â Â Â Â Â  socket.on('new_message', (messageData) => {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  allMessages[messageData.id] = messageData;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const sender = onlineUsers[messageData.username];
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  if (sender && sender.room === currentRoom) {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  createMessageElement(messageData, messageData.username === currentUser.replace(' (Admin)', ''));
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  }
Â Â Â Â Â Â Â Â Â Â Â  });
Â Â Â Â Â Â Â Â Â Â  Â 
Â Â Â Â Â Â Â Â Â Â Â  socket.on('update_message', (messageData) => {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  if (allMessages[messageData.id]) {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  allMessages[messageData.id].content = messageData.content;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const messageElement = document.getElementById(messageData.id);
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  if (messageElement) {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  messageElement.querySelector('div:nth-child(2)').innerHTML = messageData.content;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  }
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  }
Â Â Â Â Â Â Â Â Â Â Â  });

Â Â Â Â Â Â Â Â Â Â Â  socket.on('delete_message', (messageId) => {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const messageElement = document.getElementById(messageId);
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  if (messageElement) {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  messageElement.remove();
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  }
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  delete allMessages[messageId];
Â Â Â Â Â Â Â Â Â Â Â  });
Â Â Â Â Â Â Â Â Â Â  Â 
Â Â Â Â Â Â Â Â Â Â Â  socket.on('system_message', (message) => {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  displaySystemMessage(message);
Â Â Â Â Â Â Â Â Â Â Â  });

Â Â Â Â Â Â Â Â Â Â Â  socket.on('room_locked', () => {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  alert('Room is locked by an admin.');
Â Â Â Â Â Â Â Â Â Â Â  });

Â Â Â Â Â Â Â Â Â Â Â  socket.on('invite_received', (data) => {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  displayInviteMessage(data.inviter, data.room);
Â Â Â Â Â Â Â Â Â Â Â  });

Â Â Â Â Â Â Â Â Â Â Â  socket.on('global_message', (message) => {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  displayGlobalMessage(message);
Â Â Â Â Â Â Â Â Â Â Â  });

Â Â Â Â Â Â Â Â Â Â Â  socket.on('attention_call', (data) => {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  if (data.user === 'all' || data.user === currentUser.replace(' (Admin)', '')) {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  chatWindow.classList.add('shake-animation');
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  if (isAudioEnabled) {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  globalSounds[data.sound].currentTime = 0;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  globalSounds[data.sound].play();
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  }
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  setTimeout(() => chatWindow.classList.remove('shake-animation'), 500);
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  }
Â Â Â Â Â Â Â Â Â Â Â  });

Â Â Â Â Â Â Â Â Â Â Â  socket.on('update_reactions', ({ messageId, reactions }) => {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const messageElement = document.getElementById(messageId);
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  if (messageElement) {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const reactionsWrapper = messageElement.querySelector('.reactions-display');
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  reactionsWrapper.innerHTML = '';
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  for (const reaction in reactions) {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const count = reactions[reaction];
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  if (count > 0) {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const reactionSpan = document.createElement('span');
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  reactionSpan.className = 'reaction-count';
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  reactionSpan.innerHTML = `<i data-feather="${reaction}"></i>${count}`;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  reactionsWrapper.appendChild(reactionSpan);
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  }
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  }
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  feather.replace();
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  }
Â Â Â Â Â Â Â Â Â Â Â  });

Â Â Â Â Â Â Â Â Â Â Â  socket.on('search_result', (data) => {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  if (data) {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  adminSearchResults.innerHTML = `User <b>${data.username}</b> is in Room <b>${data.room}</b>.`;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  } else {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  adminSearchResults.textContent = "User not found.";
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  }
Â Â Â Â Â Â Â Â Â Â Â  });

Â Â Â Â Â Â Â Â Â Â Â  socket.on('search_result_room', (usersInRoom) => {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  if (usersInRoom.length > 0) {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  adminSearchResults.innerHTML = `Users in Room: ${usersInRoom.join(', ')}.`;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  } else {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  adminSearchResults.textContent = "Nobody in this room.";
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  }
Â Â Â Â Â Â Â Â Â Â Â  });
Â Â Â Â Â Â Â Â Â Â  Â 
Â Â Â Â Â Â Â Â Â Â Â  document.querySelectorAll('.modal-close-btn').forEach(btn => {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  btn.addEventListener('click', (e) => {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const targetId = e.target.dataset.target;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  document.getElementById(targetId).style.display = 'none';
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  });
Â Â Â Â Â Â Â Â Â Â Â  });

Â Â Â Â Â Â Â Â Â Â Â  loginBtn.addEventListener("click", login);
Â Â Â Â Â Â Â Â Â Â Â  usernameInput.addEventListener('keydown', e => { if (e.key === 'Enter') login(); });
Â Â Â Â Â Â Â Â Â Â Â  logoutBtn.addEventListener("click", () => {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  socket.emit('logout');
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  showScreen('loginScreen');
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  location.reload();
Â Â Â Â Â Â Â Â Â Â Â  });
Â Â Â Â Â Â Â Â Â Â  Â 
Â Â Â Â Â Â Â Â Â Â Â  adminPanelBtn.addEventListener('click', () => {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  adminPanelModal.style.display = 'flex';
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  updateAdminStats();
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  updateAdminRoomUsers();
Â Â Â Â Â Â Â Â Â Â Â  });

Â Â Â Â Â Â Â Â Â Â Â  adminPanelModal.addEventListener('click', e => { if(e.target === adminPanelModal) adminPanelModal.style.display = 'none'; });
Â Â Â Â Â Â Â Â Â Â Â  adminUserSearchBtn.addEventListener('click', searchUserByName);
Â Â Â Â Â Â Â Â Â Â Â  adminRoomSearchBtn.addEventListener('click', searchRoomContents);
Â Â Â Â Â Â Â Â Â Â Â  roomLockBtn.addEventListener('click', toggleRoomLock);

Â Â Â Â Â Â Â Â Â Â Â  chatIcon.addEventListener("click",()=>chatWindow.classList.toggle('open'));
Â Â Â Â Â Â Â Â Â Â Â  backToChatBtn.addEventListener("click",()=>changeRoom('0'));
Â Â Â Â Â Â Â Â Â Â Â  roomsBtn.addEventListener("click", () => roomsModal.style.display = 'flex');
Â Â Â Â Â Â Â Â Â Â Â  roomsModal.addEventListener('click', e => { if(e.target === roomsModal) roomsModal.style.display = 'none'; });
Â Â Â Â Â Â Â Â Â Â Â  joinRoomBtn.addEventListener('click', () => {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  changeRoom(roomNumberInput.value);
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  roomsModal.style.display = 'none';
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  roomNumberInput.value = '';
Â Â Â Â Â Â Â Â Â Â Â  });
Â Â Â Â Â Â Â Â Â Â Â  inviteUserBtn.addEventListener('click', () => inviteModal.style.display = 'flex');
Â Â Â Â Â Â Â Â Â Â Â  inviteModal.addEventListener('click', e => { if(e.target === inviteModal) inviteModal.style.display = 'none'; });
Â Â Â Â Â Â Â Â Â Â Â  sendBtn.addEventListener("click",sendMessage);
Â Â Â Â Â Â Â Â Â Â Â  messageInput.addEventListener('keydown',e=>{if(e.key==='Enter'&&!e.shiftKey){e.preventDefault();sendMessage();}});
Â Â Â Â Â Â Â Â Â Â  Â 
Â Â Â Â Â Â Â Â Â Â Â  chatScreen.addEventListener('click', e => {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const messageElement = e.target.closest('.chat-message');
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  if (messageElement) {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const messageId = messageElement.id;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const messageData = allMessages[messageId];
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  if (!messageData) return;

Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  reactionPopup.style.display = 'flex';
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const reactionOptionsHtml = availableReactions.map(r => `<button class="reaction-button" data-message-id="${messageId}" data-reaction="${r.id}"><i data-feather="${r.id}"></i></button>`).join('');
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  reactionPopup.querySelector('.reaction-options').innerHTML = reactionOptionsHtml;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  Â 
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const isMyMessage = messageData.username === currentUser.replace(' (Admin)', '');
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const postActions = reactionPopup.querySelector('.post-actions-buttons');
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  if (isMyMessage) {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  postActions.innerHTML = `
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  <button class="action-button edit-post" data-message-id="${messageId}" title="Edit"><i data-feather="edit-2"></i></button>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  <button class="action-button delete-post" data-message-id="${messageId}" title="Delete"><i data-feather="trash-2"></i></button>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  `;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  } else {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  postActions.innerHTML = '';
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  }

Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  feather.replace();
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  } else if (e.target.classList.contains('invite-accept-btn')) {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const roomToJoin = e.target.getAttribute('data-room');
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  changeRoom(roomToJoin);
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  }
Â Â Â Â Â Â Â Â Â Â Â  });
Â Â Â Â Â Â Â Â Â Â  Â 
Â Â Â Â Â Â Â Â Â Â Â  reactionPopup.addEventListener('click', e => {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const button = e.target.closest('button');
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  if (button) {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const messageId = button.dataset.messageId;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  Â 
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  if (button.classList.contains('reaction-button')) {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const reaction = button.dataset.reaction;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  socket.emit('add_reaction', { messageId, reaction });
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  Â 
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  if(isAudioEnabled && reactionSounds[reaction]) {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  reactionSounds[reaction].currentTime = 0;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  reactionSounds[reaction].play();
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  }
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  }Â  else if (button.classList.contains('edit-post')) {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const messageElement = document.getElementById(messageId);
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const messageContentDiv = messageElement.querySelector('div:nth-child(2)');
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  messageInput.innerHTML = messageContentDiv.innerHTML;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  isEditing = true;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  messageToEditId = messageId;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  sendBtn.innerHTML = '<i data-feather="check"></i>';
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  messageInput.focus();
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  } else if (button.classList.contains('delete-post')) {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  if (confirm("Are you sure you want to delete this message?")) {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  socket.emit('delete_message', messageId);
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  }
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  }
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  reactionPopup.style.display = 'none';
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  }
Â Â Â Â Â Â Â Â Â Â Â  });

Â Â Â Â Â Â Â Â Â Â Â  const adminGlobalMessageInput = document.getElementById('adminGlobalMessage');
Â Â Â Â Â Â Â Â Â Â Â  const sendGlobalMessageBtn = document.getElementById('sendGlobalMessageBtn');
Â Â Â Â Â Â Â Â Â Â Â  const adminGlobalFormattingToolbar = document.querySelector('.admin-global-formatting-toolbar');
Â Â Â Â Â Â Â Â Â Â  Â 
Â Â Â Â Â Â Â Â Â Â Â  adminGlobalFormattingToolbar.addEventListener('click', e => {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const button = e.target.closest('.tool-button');
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  if (!button) return;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â  Â 
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const command = button.dataset.command;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  if (['bold', 'italic', 'underline', 'strikethrough', 'shadow'].includes(command)) {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  adminGlobalStyles[command] = !adminGlobalStyles[command];
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  button.classList.toggle('active', adminGlobalStyles[command]);
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  } else if (button.id === 'admin-fontSizePlusBtn') {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  if (adminGlobalFontSize < 24) {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  adminGlobalFontSize += 2;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  adminGlobalMessageInput.style.fontSize = `${adminGlobalFontSize}px`;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  }
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  } else if (button.id === 'admin-fontSizeMinusBtn') {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  if (adminGlobalFontSize > 12) {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  adminGlobalFontSize -= 2;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  adminGlobalMessageInput.style.fontSize = `${adminGlobalFontSize}px`;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  }
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  } else if (button.id === 'admin-highlightBtn') {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  document.getElementById('admin-highlightPicker').click();
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  } else if (button.id === 'admin-colorBtn') {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  document.getElementById('admin-colorPicker').click();
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  }
Â Â Â Â Â Â Â Â Â Â Â  });

Â Â Â Â Â Â Â Â Â Â Â  document.getElementById('admin-colorPicker').addEventListener('input', e => { adminGlobalStyles.color = e.target.value; });
Â Â Â Â Â Â Â Â Â Â Â  document.getElementById('admin-highlightPicker').addEventListener('input', e => { adminGlobalStyles.highlight = e.target.value; });
Â Â Â Â Â Â Â Â Â Â Â  document.getElementById('admin-global-sound-select').addEventListener('change', (e) => {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  adminGlobalSound = e.target.value;
Â Â Â Â Â Â Â Â Â Â Â  });

Â Â Â Â Â Â Â Â Â Â Â  sendGlobalMessageBtn.addEventListener('click', () => {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const message = adminGlobalMessageInput.innerHTML.trim();
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  if (message) {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const formattedMessage = applyFormatting(message, {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  bold: adminGlobalStyles.bold,
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  italic: adminGlobalStyles.italic,
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  underline: adminGlobalStyles.underline,
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  strikethrough: adminGlobalStyles.strikethrough,
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  shadow: adminGlobalStyles.shadow,
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  color: adminGlobalStyles.color,
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  fontFamily: 'Roboto', // MantÃ©m a fonte padrÃ£o para o anÃºncio
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  highlight: adminGlobalStyles.highlight,
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  fontSize: adminGlobalFontSize
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  });
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  socket.emit('send_global_message', { content: formattedMessage, sound: adminGlobalSound });
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  adminGlobalMessageInput.innerHTML = '';
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  }
Â Â Â Â Â Â Â Â Â Â Â  });

Â Â Â Â Â Â Â Â Â Â Â  adminGlobalMessageInput.addEventListener('keydown', e => {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  if (e.key === 'Enter' && !e.shiftKey) {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  e.preventDefault();
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  sendGlobalMessageBtn.click();
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  }
Â Â Â Â Â Â Â Â Â Â Â  });

Â Â Â Â Â Â Â Â Â Â Â  toggleFormattingBtn.addEventListener('click', () => { formattingPopup.classList.toggle('open'); });
Â Â Â Â Â Â Â Â Â Â  Â 
Â Â Â Â Â Â Â Â Â Â Â  formattingPopup.addEventListener('click', e => {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const button = e.target.closest('.tool-button');
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  if (button && button.dataset.command) {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const command = button.dataset.command;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  activeStyles[command] = !activeStyles[command];
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  button.classList.toggle('active', activeStyles[command]);
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  }
Â Â Â Â Â Â Â Â Â Â Â  });

Â Â Â Â Â Â Â Â Â Â Â  fontSelect.addEventListener('change', e => { activeStyles.fontFamily = e.target.value; });

Â Â Â Â Â Â Â Â Â Â Â  colorBtn.addEventListener('click', () => { colorPicker.click(); });
Â Â Â Â Â Â Â Â Â Â Â  colorPicker.addEventListener('input', e => { activeStyles.color = e.target.value; });

Â Â Â Â Â Â Â Â Â Â Â  fontSizePlusBtn.addEventListener('click', () => {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  if (activeFontSize < 24) {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  activeFontSize += 2;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  messageInput.style.fontSize = `${activeFontSize}px`;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  }
Â Â Â Â Â Â Â Â Â Â Â  });

Â Â Â Â Â Â Â Â Â Â Â  fontSizeMinusBtn.addEventListener('click', () => {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  if (activeFontSize > 12) {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  activeFontSize -= 2;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  messageInput.style.fontSize = `${activeFontSize}px`;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  }
Â Â Â Â Â Â Â Â Â Â Â  });

Â Â Â Â Â Â Â Â Â Â Â  highlightBtn.addEventListener('click', () => { highlightPicker.click(); });
Â Â Â Â Â Â Â Â Â Â Â  highlightPicker.addEventListener('input', e => { activeStyles.highlight = e.target.value; });


Â Â Â Â Â Â Â Â Â Â Â  mentionBtn.addEventListener('click', () => {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const usernameToMention = prompt("Enter the username you want to mention:");
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  if (usernameToMention) {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  messageInput.textContent = `@${usernameToMention} `;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  messageInput.focus();
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  }
Â Â Â Â Â Â Â Â Â Â Â  });

Â Â Â Â Â Â Â Â Â Â Â  attachFileBtn.addEventListener('click', () => {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  fileUpload.click();
Â Â Â Â Â Â Â Â Â Â Â  });

Â Â Â Â Â Â Â Â Â Â Â  fileUpload.addEventListener('change', (e) => {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const file = e.target.files[0];
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  if (file) {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  if (file.type.startsWith('image/')) {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const reader = new FileReader();
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  reader.onload = function(e) {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const img = `<img src="${e.target.result}" style="max-width: 100%; max-height: 200px; display: block; margin-top: 10px; cursor: pointer;" onclick="window.open(this.src)" />`;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  socket.emit('send_message', {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  content: img
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  });
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  displaySystemMessage(`Image "${file.name}" sent.`);
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  };
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  reader.readAsDataURL(file);
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  } else {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  socket.emit('send_message', {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  content: `File attached: ${file.name}`
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  });
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  displaySystemMessage(`File "${file.name}" attached.`);
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  }
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  fileUpload.value = '';
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  }
Â Â Â Â Â Â Â Â Â Â Â  });

Â Â Â Â Â Â Â Â Â Â Â  emojiBtn.addEventListener('click', () => {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  emojiModal.style.display = 'flex';
Â Â Â Â Â Â Â Â Â Â Â Â Â Â  Â 
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const emojiCategoryMap = {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  'ğŸ˜€': 'Smileys & Emotion',
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  'ğŸ¶': 'Animals & Nature',
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  'ğŸ”': 'Food & Drink',
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  'ğŸš—': 'Activities & Travel',
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  'ğŸ’¡': 'Objects & Symbols',
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  'ğŸ‡§ğŸ‡·': 'Flags'
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  };

Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  let emojiHtml = `<div class="emoji-category-tabs">`;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  for (const emojiKey in emojis) {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  emojiHtml += `<button data-category-key="${emojiKey}">${emojiKey}</button>`;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  }
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  emojiHtml += `</div>`;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  emojiHtml += `<div id="emoji-list-content" class="emoji-picker-container"></div>`;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  emojiPicker.innerHTML = emojiHtml;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â  Â 
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const emojiListContent = document.getElementById('emoji-list-content');
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  let initialCategoryKey = 'ğŸ˜€'; 
Â Â Â Â Â Â Â Â Â Â Â Â Â Â  Â 
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const renderEmojis = (categoryKey) => {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const categoryEmojis = emojis[categoryKey];
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  emojiListContent.innerHTML = categoryEmojis.map(emoji => `<button class="emoji-button">${emoji}</button>`).join('');
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  };
Â Â Â Â Â Â Â Â Â Â Â Â Â Â  Â 
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  renderEmojis(initialCategoryKey);

Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const categoryTabs = document.querySelector('.emoji-category-tabs');
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  categoryTabs.addEventListener('click', e => {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const button = e.target.closest('button');
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  if (button) {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const categoryKey = button.dataset.categoryKey;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  renderEmojis(categoryKey);
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  }
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  });
Â Â Â Â Â Â Â Â Â Â Â  });

Â Â Â Â Â Â Â Â Â Â Â  emojiPicker.addEventListener('click', e => {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const button = e.target.closest('.emoji-button');
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  if (button) {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  messageInput.textContent += button.textContent;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  emojiModal.style.display = 'none';
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  messageInput.focus();
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  }
Â Â Â Â Â Â Â Â Â Â Â  });
Â Â Â Â Â Â Â Â Â Â  Â 
Â Â Â Â Â Â Â Â Â Â Â  saveChatBtn.addEventListener('click', () => {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const element = document.getElementById('chatScreen');
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const opt = {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  margin: 1,
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  filename: `chat-sala-${currentRoom}.pdf`,
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  image: { type: 'jpeg', quality: 0.98 },
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  html2canvas: { scale: 2 },
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  jsPDF: { unit: 'in', format: 'letter', orientation: 'portrait' }
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  };
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  html2pdf().from(element).set(opt).save();
Â Â Â Â Â Â Â Â Â Â Â  });
Â Â Â Â Â Â Â Â Â Â  Â 
Â Â Â Â Â Â Â Â Â Â Â  usersOnlineBtn.addEventListener('click', () => {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  usersOnlineModal.style.display = 'flex';
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const usersInCurrentRoom = Object.values(onlineUsers).filter(user => user.room === currentRoom);
Â Â Â Â Â Â Â Â Â Â Â Â Â Â  Â 
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  let usersHtml = '<h3>Users in Room:</h3>';
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  if (usersInCurrentRoom.length > 0) {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  usersHtml += `<ul>${usersInCurrentRoom.map(user => `<li>${user.username}</li>`).join('')}</ul>`;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  } else {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  usersHtml += '<p>No other users in this room.</p>';
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  }

Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  usersListDiv.innerHTML = usersHtml;
Â Â Â Â Â Â Â Â Â Â Â  });

Â Â Â Â Â Â Â Â Â Â Â  alarmBtn.addEventListener('click', () => {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  if (!userAlarmCounts[currentUser]) {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  userAlarmCounts[currentUser] = 0;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  }
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  if (userAlarmCounts[currentUser] >= 3) {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  alert('You can only call for attention 3 times per hour. Please wait to try again.');
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  return;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  }

Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  alarmModal.style.display = 'flex';
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const usersInRoom = Object.values(onlineUsers).filter(user => user.room === currentRoom);
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const userListHtml = usersInRoom.map(user => `<button data-user="${user.username}">${user.username}</button>`).join('');
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  alarmOptionsDiv.innerHTML = `<h3>Call Attention: (${userAlarmCounts[currentUser]}/3)</h3><button data-user="all">All in Room</button>${userListHtml}`;
Â Â Â Â Â Â Â Â Â Â Â  });
Â Â Â Â Â Â Â Â Â Â  Â 
Â Â Â Â Â Â Â Â Â Â Â  alarmOptionsDiv.addEventListener('click', e => {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const button = e.target.closest('button');
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  if (button) {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const user = button.dataset.user;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  if (!userAlarmCounts[currentUser]) {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  userAlarmCounts[currentUser] = 0;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  }
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  userAlarmCounts[currentUser]++;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  Â 
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  if (user === 'all') {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  socket.emit('call_attention', { user: 'all', sound: 'applauseSound' });
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  displaySystemMessage(`${currentUser.replace(' (Admin)', '')} is calling everyone's attention.`);
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  } else {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  socket.emit('call_attention', { user: user, sound: 'attentionSound' });
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  displaySystemMessage(`${currentUser.replace(' (Admin)', '')} is calling ${user}'s attention.`);
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  }
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  alarmModal.style.display = 'none';
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  }
Â Â Â Â Â Â Â Â Â Â Â  });
Â Â Â Â Â Â Â Â Â Â  Â 
Â Â Â Â Â Â Â Â Â Â Â  usersOnlineModal.addEventListener('click', e => { if(e.target === usersOnlineModal) usersOnlineModal.style.display = 'none'; });
Â Â Â Â Â Â Â Â Â Â Â  alarmModal.addEventListener('click', e => { if(e.target === alarmModal) alarmModal.style.display = 'none'; });
Â Â Â Â Â Â Â Â Â Â Â  emojiModal.addEventListener('click', e => { if(e.target === emojiModal) emojiModal.style.display = 'none'; });


Â Â Â Â Â Â Â Â Â Â Â  audioToggleBtn.addEventListener('click', () => {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  isAudioEnabled = !isAudioEnabled;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  const icon = audioToggleBtn.querySelector('i');
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  icon.setAttribute('data-feather', isAudioEnabled ? 'volume-2' : 'volume-x');
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  feather.replace();
Â Â Â Â Â Â Â Â Â Â Â  });

Â Â Â Â Â Â Â Â Â Â Â  minimizeChatBtn.addEventListener('click', () => {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  chatWindow.classList.add('minimized');
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  chatWindow.classList.remove('maximized');
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  chatWindow.classList.remove('mobile-view');
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  maximizeChatBtn.style.display = 'flex';
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  restoreChatBtn.style.display = 'none';
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  mobileViewBtn.style.display = 'flex';
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  minimizeChatBtn.style.display = 'none';
Â Â Â Â Â Â Â Â Â Â Â  });
Â Â Â Â Â Â Â Â Â Â  Â 
Â Â Â Â Â Â Â Â Â Â Â  maximizeChatBtn.addEventListener('click', () => {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  chatWindow.classList.add('maximized');
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  chatWindow.classList.remove('minimized');
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  chatWindow.classList.remove('mobile-view');
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  maximizeChatBtn.style.display = 'none';
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  restoreChatBtn.style.display = 'flex';
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  mobileViewBtn.style.display = 'flex';
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  minimizeChatBtn.style.display = 'flex';
Â Â Â Â Â Â Â Â Â Â Â  });

Â Â Â Â Â Â Â Â Â Â Â  restoreChatBtn.addEventListener('click', () => {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  chatWindow.classList.remove('maximized');
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  chatWindow.classList.remove('minimized');
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  chatWindow.classList.remove('mobile-view');
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  restoreChatBtn.style.display = 'none';
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  maximizeChatBtn.style.display = 'flex';
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  mobileViewBtn.style.display = 'flex';
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  minimizeChatBtn.style.display = 'flex';
Â Â Â Â Â Â Â Â Â Â Â  });
Â Â Â Â Â Â Â Â Â Â  Â 
Â Â Â Â Â Â Â Â Â Â Â  mobileViewBtn.addEventListener('click', () => {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  chatWindow.classList.add('mobile-view');
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  chatWindow.classList.remove('maximized');
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  chatWindow.classList.remove('minimized');
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  mobileViewBtn.style.display = 'none';
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  maximizeChatBtn.style.display = 'none';
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  restoreChatBtn.style.display = 'flex';
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  minimizeChatBtn.style.display = 'flex';
Â Â Â Â Â Â Â Â Â Â Â  });

Â Â Â Â Â Â Â Â Â Â Â  colorPaletteBtn.addEventListener('click', () => {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  chatWallpaperColor.click();
Â Â Â Â Â Â Â Â Â Â Â  });

Â Â Â Â Â Â Â Â Â Â Â  chatWallpaperColor.addEventListener('input', (e) => {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  chatScreen.style.backgroundColor = e.target.value;
Â Â Â Â Â Â Â Â Â Â Â  });
Â Â Â Â Â Â Â Â Â Â  Â 
Â Â Â Â Â Â Â Â Â Â Â  googleFonts.forEach(fontName=>{const option=document.createElement('option');option.value=fontName;option.textContent=fontName;option.style.fontFamily=fontName;fontSelect.appendChild(option);});
Â Â Â Â Â Â Â Â Â Â  Â 
Â Â Â Â Â Â Â Â Â Â Â  feather.replace();
Â Â Â Â Â Â Â Â Â Â Â  showScreen('loginScreen');
Â Â Â Â Â Â Â  });
Â Â Â  </script>
</body>
</html>
